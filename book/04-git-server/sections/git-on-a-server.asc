[[_git_on_a_server]]
=== Cài đặt Git trên một Máy chủ

Bây giờ chúng ta sẽ đề cập đến cách cài đặt Git trên một máy chủ.

[NOTE]
====
Chúng ta sẽ đi qua việc thiết lập một máy chủ với giao thức SSH, vì đây là thiết lập phổ biến nhất.
SSH cũng là một trong những cách duy nhất để có cả quyền đọc và ghi vào một máy chủ trong khi vẫn đảm bảo an toàn.
Các giao thức khác có sẵn, nhưng chúng thường phức tạp hơn để thiết lập, hoặc chỉ có quyền đọc.
====

Để thiết lập ban đầu bất kỳ máy chủ Git nào, bạn phải xuất một kho lưu trữ hiện có vào một kho lưu trữ trần mới -- một kho lưu trữ không chứa thư mục làm việc.
Điều này thường dễ thực hiện.
Để sao chép một kho lưu trữ để tạo một kho lưu trữ trần mới, bạn chạy lệnh clone với tùy chọn `--bare`.
Theo quy ước, các thư mục kho lưu trữ trần kết thúc bằng `.git`, như sau:

[source,console]
----
$ git clone --bare my_project my_project.git
Cloning into bare repository 'my_project.git'...
done.
----

Bây giờ bạn sẽ có một bản sao của dữ liệu thư mục Git trong thư mục `my_project.git` của bạn.

Đầu ra của lệnh `git clone --bare` hơi khó hiểu.
Vì việc sao chép về cơ bản là một `git init` sau đó là một `git fetch`, đầu ra của `git init` được in ra, tạo ra một thư mục _trống_.
Các đối tượng thực tế sau đó được chuyển, nhưng không có phản hồi nào được đưa ra.
Tuy nhiên, bạn _sẽ_ có một bản sao đầy đủ của dữ liệu kho lưu trữ Git trong thư mục `my_project.git`.

Điều này gần tương đương với:

[source,console]
----
$ cp -Rf my_project/.git my_project.git
----

mặc dù có một vài khác biệt nhỏ trong tệp cấu hình; nhưng đối với mục đích của bạn, điều này gần giống nhau.
Nó chỉ lấy kho lưu trữ Git, không có thư mục làm việc, và tạo ra một thư mục riêng cho nó.

==== Đặt Kho lưu trữ Trần trên một Máy chủ

Bây giờ bạn đã có một bản sao trần của kho lưu trữ của mình, tất cả những gì bạn cần làm là đặt nó trên một máy chủ và thiết lập các giao thức của bạn.
Giả sử bạn đã thiết lập một máy chủ có tên `git.example.com` mà bạn có quyền truy cập SSH và bạn muốn lưu trữ tất cả các kho lưu trữ Git của mình trong thư mục `/srv/git`.
Giả sử rằng `/srv/git` tồn tại trên máy chủ đó, bạn có thể thiết lập kho lưu trữ mới của mình bằng cách sao chép kho lưu trữ trần của bạn qua:

[source,console]
----
$ scp -r my_project.git user@git.example.com:/srv/git
----

Tại thời điểm này, những người dùng khác có quyền truy cập SSH vào cùng một máy chủ có quyền đọc vào thư mục `/srv/git` có thể sao chép kho lưu trữ của bạn bằng cách chạy:

[source,console]
----
$ git clone user@git.example.com:/srv/git/my_project.git
----

Nếu một người dùng, có quyền truy cập SSH vào một máy chủ, có quyền ghi vào thư mục `/srv/git/my_project.git`, họ cũng sẽ tự động có quyền đẩy.

Git sẽ tự động thêm quyền ghi nhóm vào một kho lưu trữ nếu bạn chạy lệnh `git init` với tùy chọn `--shared`.

[source,console]
----
$ ssh user@git.example.com
$ cd /srv/git/my_project.git
$ git init --bare --shared
----

Bạn thấy việc lấy một kho lưu trữ Git, tạo một phiên bản trần của nó và đặt nó trên một máy chủ mà bạn và các cộng tác viên của bạn có quyền truy cập SSH dễ dàng như thế nào.
Bây giờ bạn đã sẵn sàng để cộng tác trên cùng một dự án.

Điều quan trọng cần lưu ý là đây thực sự là tất cả những gì bạn cần làm để chạy một máy chủ Git hữu ích mà nhiều người có quyền truy cập -- chỉ cần thêm các tài khoản có thể SSH trên một máy chủ, và đặt một kho lưu trữ trần ở đâu đó mà tất cả những người dùng đó đều có quyền đọc và ghi.
Bạn đã sẵn sàng -- không cần gì khác.

Trong vài phần tiếp theo, bạn sẽ thấy cách mở rộng điều này.
Chúng ta sẽ đề cập đến cách thiết lập quyền truy cập đọc ẩn danh, cách thêm giao diện web, sử dụng một công cụ có tên là GitLab, và nhiều hơn nữa.
Tuy nhiên, hãy nhớ rằng để cộng tác với một vài người trong một dự án riêng tư, một máy chủ SSH và một kho lưu trữ trần là tất cả những gì bạn cần.

==== Các Thiết lập Nhỏ

Nếu bạn là một tổ chức nhỏ hoặc chỉ đang thử nghiệm Git trong tổ chức của mình và chỉ có một vài nhà phát triển, mọi thứ có thể đơn giản cho bạn.
Một trong những khía cạnh phức tạp nhất của việc thiết lập một máy chủ Git là quản lý người dùng.
Nếu bạn muốn một số kho lưu trữ chỉ đọc đối với một số người dùng và đọc/ghi đối với những người khác, việc sắp xếp quyền truy cập và quyền có thể hơi khó khăn hơn.

===== Truy cập SSH

(((serving repositories, SSH)))
Nếu bạn có một máy chủ mà tất cả các nhà phát triển của bạn đã có quyền truy cập SSH, thường thì việc thiết lập kho lưu trữ đầu tiên của bạn ở đó là dễ nhất, bởi vì bạn gần như không phải làm gì cả (như chúng ta đã đề cập trong phần cuối).
Nếu bạn muốn có các quyền kiểm soát truy cập phức tạp hơn trên các kho lưu trữ của mình, bạn có thể xử lý chúng bằng các quyền hệ thống tệp thông thường của hệ điều hành mà máy chủ của bạn đang chạy.

Nếu bạn muốn đặt các kho lưu trữ của mình trên một máy chủ không có tài khoản cho mọi người trong nhóm của bạn mà bạn muốn có quyền ghi, thì bạn phải thiết lập quyền truy cập SSH cho họ.
Chúng tôi giả định rằng nếu bạn có một máy chủ để làm điều này, bạn đã có một máy chủ SSH được cài đặt và đang chạy.