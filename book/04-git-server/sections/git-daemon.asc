[[_git_daemon]]
=== Git Daemon

Tiếp theo, bạn sẽ thiết lập một máy chủ dựa trên daemon.
Đây là một lựa chọn phổ biến để truy cập nhanh, không cần xác thực vào dữ liệu Git của bạn.
Hãy nhớ rằng vì đây không phải là một dịch vụ được xác thực, bất cứ thứ gì bạn phục vụ qua giao thức này đều là công khai trong mạng của nó.

Nếu bạn đang chạy cái này trên một máy chủ bên ngoài tường lửa của mình, nó chỉ nên được sử dụng cho các dự án có thể nhìn thấy công khai trên toàn thế giới.
Nếu bạn đang chạy nó bên trong tường lửa của mình, bạn có thể sử dụng nó cho các dự án mà một số lượng lớn người hoặc máy tính (máy chủ tích hợp liên tục hoặc xây dựng) có quyền truy cập chỉ đọc, khi bạn không muốn phải quản lý một khóa SSH cho mỗi người.

Trong mọi trường hợp, giao thức Git tương đối dễ thiết lập.
Về cơ bản, bạn cần chạy lệnh này dưới dạng một daemon:

[source,console]
----
$ git daemon --reuseaddr --base-path=/srv/git/ /srv/git/
----

`--reuseaddr` cho phép máy chủ khởi động lại mà không cần chờ các kết nối cũ hết thời gian, trong khi `--base-path` cho phép mọi người sao chép các dự án mà không cần phải chỉ định toàn bộ đường dẫn.
Đường dẫn ở cuối cho daemon Git biết nơi tìm kiếm các kho lưu trữ để xuất.
Nếu bạn đang chạy tường lửa, bạn cũng sẽ cần phải tạo một lỗ hổng trong đó tại cổng 9418 trên hộp bạn đang thiết lập cái này.

Bạn có thể biến quá trình này thành daemon theo một số cách, tùy thuộc vào hệ điều hành bạn đang chạy.
Trên máy Ubuntu, bạn có thể sử dụng một tập lệnh Upstart.
Vì vậy, trong tệp sau:

[source]
----
/etc/init/git-daemon.conf
----

bạn có thể đặt tập lệnh này:

[source]
----
start on startup
stop on shutdown
exec /usr/bin/git daemon --user=git --group=git \
    --reuseaddr \
    --base-path=/srv/git/ \
    /srv/git/
respawn
----

Vì lý do bảo mật, rất khuyến khích để daemon này chạy với tư cách người dùng có quyền chỉ đọc đối với các kho lưu trữ -- bạn có thể dễ dàng thực hiện điều này bằng cách tạo người dùng mới `git-ro` và chạy daemon với tư cách là họ.
Để đơn giản, chúng tôi sẽ chỉ chạy nó với tư cách là người dùng `git` giống như `git-shell` đang chạy.

[NOTE]
====
Khi bạn khởi động lại máy chủ của mình, daemon Git của bạn cũng sẽ khởi động lại.
Để khởi động hoặc dừng nó theo cách thủ công, bạn có thể sử dụng các lệnh:

[source,console]
----
$ sudo start git-daemon
$ sudo stop git-daemon
----
====

Trên các hệ thống khác, bạn có thể muốn sử dụng `xinetd`, một tập lệnh trong hệ thống `sysvinit` của bạn, hoặc một cái gì đó khác -- miễn là bạn biến lệnh đó thành daemon và được theo dõi bằng cách nào đó.

Tiếp theo, bạn phải cho Git biết kho lưu trữ nào được phép truy cập dựa trên máy chủ Git không được xác thực.
Bạn có thể làm điều này trong mỗi kho lưu trữ bằng cách tạo một tệp có tên `git-daemon-export-ok`.

[source,console]
----
$ cd /path/to/project.git
$ touch git-daemon-export-ok
----

Sự hiện diện của tệp đó cho Git biết rằng có thể phục vụ dự án này mà không cần xác thực.