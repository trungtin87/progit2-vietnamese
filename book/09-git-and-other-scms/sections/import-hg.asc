==== Mercurial

(((Mercurial)))(((Importing, from Mercurial)))
Vì Mercurial và Git có các mô hình khá tương tự để biểu diễn các phiên bản, và vì Git linh hoạt hơn một chút, việc chuyển đổi một kho chứa từ Mercurial sang Git khá đơn giản, sử dụng một công cụ gọi là "hg-fast-export", mà bạn sẽ cần một bản sao:

[source,console]
----
$ git clone https://github.com/frej/fast-export.git
----

Bước đầu tiên trong quá trình chuyển đổi là lấy một bản sao đầy đủ của kho chứa Mercurial mà bạn muốn chuyển đổi:

[source,console]
----
$ hg clone <remote repo URL> /tmp/hg-repo
----

Bước tiếp theo là tạo một tập tin ánh xạ tác giả.
Mercurial khoan dung hơn một chút so với Git về những gì nó sẽ đặt trong trường tác giả cho các changeset, vì vậy đây là thời điểm tốt để dọn dẹp.
Tạo điều này là một lệnh một dòng trong shell `bash`:

[source,console]
----
$ cd /tmp/hg-repo
$ hg log | grep user: | sort | uniq | sed 's/user: *//' > ../authors
----

Điều này sẽ mất vài giây, tùy thuộc vào lịch sử dự án của bạn dài bao lâu, và sau đó tập tin `/tmp/authors` sẽ trông giống như thế này:

[source]
----
bob
bob@localhost
bob <bob@company.com>
bob jones <bob <AT> company <DOT> com>
Bob Jones <bob@company.com>
Joe Smith <joe@company.com>
----

Trong ví dụ này, cùng một người (Bob) đã tạo các changeset dưới bốn tên khác nhau, một trong số đó thực sự trông đúng, và một trong số đó sẽ hoàn toàn không hợp lệ cho một commit Git.
Hg-fast-export cho phép chúng ta sửa điều này bằng cách biến mỗi dòng thành một quy tắc: `"<input>"="<output>"`, ánh xạ một `<input>` sang một `<output>`.
Bên trong các chuỗi `<input>` và `<output>`, tất cả các chuỗi thoát được hiểu bởi mã hóa `string_escape` của Python đều được hỗ trợ.
Nếu tập tin ánh xạ tác giả không chứa `<input>` khớp, tác giả đó sẽ được gửi đến Git mà không được sửa đổi.
Nếu tất cả tên người dùng trông ổn, chúng ta sẽ không cần tập tin này chút nào.
Trong ví dụ này, chúng ta muốn tập tin của mình trông như thế này:

[source]
----
"bob"="Bob Jones <bob@company.com>"
"bob@localhost"="Bob Jones <bob@company.com>"
"bob <bob@company.com>"="Bob Jones <bob@company.com>"
"bob jones <bob <AT> company <DOT> com>"="Bob Jones <bob@company.com>"
----

Cùng loại tập tin ánh xạ có thể được sử dụng để đổi tên các nhánh và thẻ khi tên Mercurial không được Git cho phép.

Bước tiếp theo là tạo kho chứa Git mới của chúng ta, và chạy tập tin kịch bản xuất:

[source,console]
----
$ git init /tmp/converted
$ cd /tmp/converted
$ /tmp/fast-export/hg-fast-export.sh -r /tmp/hg-repo -A /tmp/authors
----

Cờ `-r` bảo hg-fast-export tìm kho chứa Mercurial mà chúng ta muốn chuyển đổi ở đâu, và cờ `-A` bảo nó tìm tập tin ánh xạ tác giả ở đâu (các tập tin ánh xạ nhánh và thẻ được chỉ định bởi các cờ `-B` và `-T` tương ứng).
Tập tin kịch bản phân tích cú pháp các changeset Mercurial và chuyển đổi chúng thành một tập tin kịch bản cho tính năng "fast-import" của Git (mà chúng ta sẽ thảo luận chi tiết hơn một chút sau).
Điều này mất một chút (mặc dù nó _nhanh hơn nhiều_ so với nó sẽ là qua mạng), và đầu ra khá dài dòng:

[source,console]
----
$ /tmp/fast-export/hg-fast-export.sh -r /tmp/hg-repo -A /tmp/authors
Loaded 4 authors
master: Exporting full revision 1/22208 with 13/0/0 added/changed/removed files
master: Exporting simple delta revision 2/22208 with 1/1/0 added/changed/removed files
master: Exporting simple delta revision 3/22208 with 0/1/0 added/changed/removed files
[…]
master: Exporting simple delta revision 22206/22208 with 0/4/0 added/changed/removed files
master: Exporting simple delta revision 22207/22208 with 0/2/0 added/changed/removed files
master: Exporting thorough delta revision 22208/22208 with 3/213/0 added/changed/removed files
Exporting tag [0.4c] at [hg r9] [git :10]
Exporting tag [0.4d] at [hg r16] [git :17]
[…]
Exporting tag [3.1-rc] at [hg r21926] [git :21927]
Exporting tag [3.1] at [hg r21973] [git :21974]
Issued 22315 commands
git-fast-import statistics:
---------------------------------------------------------------------
Alloc'd objects:     120000
Total objects:       115032 (    208171 duplicates                  )
      blobs  :        40504 (    205320 duplicates      26117 deltas of      39602 attempts)
      trees  :        52320 (      2851 duplicates      47467 deltas of      47599 attempts)
      commits:        22208 (         0 duplicates          0 deltas of          0 attempts)
      tags   :            0 (         0 duplicates          0 deltas of          0 attempts)
Total branches:         109 (         2 loads     )
      marks:        1048576 (     22208 unique    )
      atoms:           1952
Memory total:          7860 KiB
       pools:          2235 KiB
     objects:          5625 KiB
---------------------------------------------------------------------
pack_report: getpagesize()            =       4096
pack_report: core.packedGitWindowSize = 1073741824
pack_report: core.packedGitLimit      = 8589934592
pack_report: pack_used_ctr            =      90430
pack_report: pack_mmap_calls          =      46771
pack_report: pack_open_windows        =          1 /          1
pack_report: pack_mapped              =  340852700 /  340852700
---------------------------------------------------------------------

$ git shortlog -sn
   369  Bob Jones
   365  Joe Smith
----

Đó là khá nhiều tất cả những gì có.
Tất cả các thẻ Mercurial đã được chuyển đổi thành các thẻ Git, và các nhánh và dấu trang Mercurial đã được chuyển đổi thành các nhánh Git.
Bây giờ bạn đã sẵn sàng đẩy kho chứa lên nhà mới phía máy chủ của nó:

[source,console]
----
$ git remote add origin git@my-git-server:myrepository.git
$ git push origin --all
----
