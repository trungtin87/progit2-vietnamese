[[_perforce_import]]
==== Perforce

(((Perforce)))(((Importing, from Perforce)))
Hệ thống tiếp theo bạn sẽ xem xét việc nhập từ đó là Perforce.
Như chúng ta đã thảo luận ở trên, có hai cách để cho Git và Perforce nói chuyện với nhau: git-p4 và Perforce Git Fusion.

===== Perforce Git Fusion

Git Fusion làm cho quá trình này khá không đau đớn.
Chỉ cần cấu hình các thiết lập dự án, ánh xạ người dùng, và các nhánh của bạn bằng cách sử dụng một tập tin cấu hình (như đã thảo luận trong <<_p4_git_fusion>>), và sao chép kho chứa.
Git Fusion để lại cho bạn những gì trông giống như một kho chứa Git bản địa, sau đó sẵn sàng để đẩy lên một máy chủ Git bản địa nếu bạn muốn.
Bạn thậm chí có thể sử dụng Perforce làm máy chủ Git của bạn nếu bạn thích.

[[_git_p4]]
===== Git-p4

Git-p4 cũng có thể hoạt động như một công cụ nhập.
Như một ví dụ, chúng ta sẽ nhập dự án Jam từ Perforce Public Depot.
Để thiết lập máy khách của bạn, bạn phải xuất biến môi trường P4PORT để trỏ đến depot Perforce:

[source,console]
----
$ export P4PORT=public.perforce.com:1666
----

[NOTE]
====
Để theo dõi, bạn sẽ cần một depot Perforce để kết nối.
Chúng tôi sẽ sử dụng depot công khai tại public.perforce.com cho các ví dụ của chúng tôi, nhưng bạn có thể sử dụng bất kỳ depot nào bạn có quyền truy cập.
====

(((git commands, p4)))
Chạy lệnh `git p4 clone` để nhập dự án Jam từ máy chủ Perforce, cung cấp đường dẫn depot và dự án và đường dẫn mà bạn muốn nhập dự án vào:

[source,console]
----
$ git-p4 clone //guest/perforce_software/jam@all p4import
Importing from //guest/perforce_software/jam@all into p4import
Initialized empty Git repository in /private/tmp/p4import/.git/
Import destination: refs/remotes/p4/master
Importing revision 9957 (100%)
----

Dự án cụ thể này chỉ có một nhánh, nhưng nếu bạn có các nhánh được cấu hình với các view nhánh (hoặc chỉ là một tập hợp các thư mục), bạn có thể sử dụng cờ `--detect-branches` cho `git p4 clone` để nhập tất cả các nhánh của dự án.
Xem <<_git_p4_branches>> để biết thêm chi tiết về điều này.

Tại thời điểm này bạn gần như hoàn thành.
Nếu bạn đi đến thư mục `p4import` và chạy `git log`, bạn có thể thấy công việc đã nhập của mình:

[source,console]
----
$ git log -2
commit e5da1c909e5db3036475419f6379f2c73710c4e6
Author: giles <giles@giles@perforce.com>
Date:   Wed Feb 8 03:13:27 2012 -0800

    Correction to line 355; change </UL> to </OL>.

    [git-p4: depot-paths = "//public/jam/src/": change = 8068]

commit aa21359a0a135dda85c50a7f7cf249e4f7b8fd98
Author: kwirth <kwirth@perforce.com>
Date:   Tue Jul 7 01:35:51 2009 -0800

    Fix spelling error on Jam doc page (cummulative -> cumulative).

    [git-p4: depot-paths = "//public/jam/src/": change = 7304]
----

Bạn có thể thấy rằng `git-p4` đã để lại một định danh trong mỗi thông điệp commit.
Không sao khi giữ định danh đó ở đó, trong trường hợp bạn cần tham chiếu số thay đổi Perforce sau này.
Tuy nhiên, nếu bạn muốn xóa định danh, bây giờ là lúc để làm như vậy – trước khi bạn bắt đầu thực hiện công việc trên kho chứa mới.
(((git commands, filter-branch)))
Bạn có thể sử dụng `git filter-branch` để xóa các chuỗi định danh hàng loạt:

[source,console]
----
$ git filter-branch --msg-filter 'sed -e "/^\[git-p4:/d"'
Rewrite e5da1c909e5db3036475419f6379f2c73710c4e6 (125/125)
Ref 'refs/heads/master' was rewritten
----

Nếu bạn chạy `git log`, bạn có thể thấy rằng tất cả các tổng kiểm tra SHA-1 cho các commit đã thay đổi, nhưng các chuỗi `git-p4` không còn trong các thông điệp commit nữa:

[source,console]
----
$ git log -2
commit b17341801ed838d97f7800a54a6f9b95750839b7
Author: giles <giles@giles@perforce.com>
Date:   Wed Feb 8 03:13:27 2012 -0800

    Correction to line 355; change </UL> to </OL>.

commit 3e68c2e26cd89cb983eb52c024ecdfba1d6b3fff
Author: kwirth <kwirth@perforce.com>
Date:   Tue Jul 7 01:35:51 2009 -0800

    Fix spelling error on Jam doc page (cummulative -> cumulative).
----

Bản nhập của bạn đã sẵn sàng để đẩy lên máy chủ Git mới của bạn.
