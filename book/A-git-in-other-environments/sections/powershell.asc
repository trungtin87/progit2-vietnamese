[[_git_powershell]]
=== Git trong PowerShell

(((PowerShell)))(((tab completion, PowerShell)))(((shell prompts, PowerShell)))
(((posh-git)))
Terminal dòng lệnh cũ trên Windows (`cmd.exe`) không thực sự có khả năng tùy chỉnh trải nghiệm Git, nhưng nếu bạn đang sử dụng PowerShell, bạn may mắn.
Điều này cũng hoạt động nếu bạn đang chạy PowerShell Core trên Linux hoặc macOS.
Một gói có tên posh-git (https://github.com/dahlbyk/posh-git[^]) cung cấp các tiện ích tab-completion mạnh mẽ, cũng như một dấu nhắc nâng cao để giúp bạn theo dõi trạng thái kho chứa của mình.
Nó trông như thế này:

.PowerShell với Posh-git
image::images/posh-git.png[PowerShell với Posh-git]

==== Cài đặt

===== Điều kiện tiên quyết (chỉ Windows)

Trước khi bạn có thể chạy các tập tin kịch bản PowerShell trên máy của mình, bạn cần đặt `ExecutionPolicy` cục bộ của mình thành `RemoteSigned` (về cơ bản, bất cứ thứ gì ngoại trừ `Undefined` và `Restricted`).
Nếu bạn chọn `AllSigned` thay vì `RemoteSigned`, cả các tập tin kịch bản cục bộ (của riêng bạn) cũng cần được ký số để được thực thi.
Với `RemoteSigned`, chỉ các tập tin kịch bản có `ZoneIdentifier` được đặt thành `Internet` (đã được tải xuống từ web) cần được ký, những cái khác thì không.
Nếu bạn là quản trị viên và muốn đặt nó cho tất cả người dùng trên máy đó, hãy sử dụng `-Scope LocalMachine`.
Nếu bạn là người dùng bình thường, không có quyền quản trị, bạn có thể sử dụng `-Scope CurrentUser` để đặt nó chỉ cho bạn.

Thêm về PowerShell Scopes: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_scopes[^].

Thêm về PowerShell ExecutionPolicy: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-executionpolicy[^].

Để đặt giá trị của `ExecutionPolicy` thành `RemoteSigned` cho tất cả người dùng, hãy sử dụng lệnh tiếp theo:

[source,powershell]
----
> Set-ExecutionPolicy -Scope LocalMachine -ExecutionPolicy RemoteSigned -Force
----

===== PowerShell Gallery

Nếu bạn có ít nhất PowerShell 5 hoặc PowerShell 4 với PackageManagement được cài đặt, bạn có thể sử dụng trình quản lý gói để cài đặt posh-git cho bạn.

Thêm thông tin về PowerShell Gallery: https://learn.microsoft.com/en-us/powershell/scripting/gallery/overview[^].

[source,powershell]
----
> Install-Module posh-git -Scope CurrentUser -Force
> Install-Module posh-git -Scope CurrentUser -AllowPrerelease -Force # Phiên bản beta mới hơn với hỗ trợ PowerShell Core
----

Nếu bạn muốn cài đặt posh-git cho tất cả người dùng, hãy sử dụng `-Scope AllUsers` thay thế và thực thi lệnh từ một console PowerShell nâng cao.
Nếu lệnh thứ hai thất bại với lỗi như `Module 'PowerShellGet' was not installed by using Install-Module`, bạn sẽ cần chạy một lệnh khác trước:

[source,powershell]
----
> Install-Module PowerShellGet -Force -SkipPublisherCheck
----

Sau đó bạn có thể quay lại và thử lại.
Điều này xảy ra, vì các module đi kèm với Windows PowerShell được ký bằng một chứng chỉ xuất bản khác.

===== Cập nhật Dấu nhắc PowerShell

Để bao gồm thông tin Git trong dấu nhắc của bạn, module posh-git cần được nhập.
Để posh-git được nhập mỗi khi PowerShell khởi động, hãy thực thi lệnh `Add-PoshGitToProfile` sẽ thêm câu lệnh nhập vào tập tin kịch bản `$profile` của bạn.
Tập tin kịch bản này được thực thi mỗi khi bạn mở một console PowerShell mới.
Hãy nhớ rằng, có nhiều tập tin kịch bản `$profile`.
Ví dụ, một cho console và một riêng cho ISE.

[source,powershell]
----
> Import-Module posh-git
> Add-PoshGitToProfile -AllHosts
----

===== Từ Mã nguồn

Chỉ cần tải xuống một bản phát hành posh-git từ https://github.com/dahlbyk/posh-git/releases[^], và giải nén nó.
Sau đó nhập module bằng cách sử dụng đường dẫn đầy đủ đến tập tin `posh-git.psd1`:

[source,powershell]
----
> Import-Module <path-to-uncompress-folder>\\src\\posh-git.psd1
> Add-PoshGitToProfile -AllHosts
----

Điều này sẽ thêm dòng thích hợp vào tập tin `profile.ps1` của bạn, và posh-git sẽ hoạt động lần tiếp theo bạn mở PowerShell.

Để biết mô tả về thông tin tóm tắt trạng thái Git được hiển thị trong dấu nhắc, xem: https://github.com/dahlbyk/posh-git/blob/master/README.md#git-status-summary-information[^]
Để biết thêm chi tiết về cách tùy chỉnh dấu nhắc posh-git của bạn, xem: https://github.com/dahlbyk/posh-git/blob/master/README.md#customization-variables[^].
