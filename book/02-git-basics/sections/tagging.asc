[[_git_tagging]]
=== Gắn Thẻ

(((tags)))
Giống như hầu hết các VCS, Git có khả năng gắn thẻ các điểm cụ thể trong lịch sử của kho lưu trữ là quan trọng.
Thông thường, mọi người sử dụng chức năng này để đánh dấu các điểm phát hành (`v1.0`, `v2.0` và như vậy).
Trong phần này, bạn sẽ học cách liệt kê các thẻ hiện có, cách tạo và xóa thẻ và các loại thẻ khác nhau là gì.

==== Liệt kê Thẻ của Bạn

Liệt kê các thẻ hiện có trong Git rất đơn giản.
Chỉ cần nhập `git tag` (với tùy chọn `-l` hoặc `--list`):(((git commands, tag)))

[source,console]
----
$ git tag
v1.0
v2.0
----

Lệnh này liệt kê các thẻ theo thứ tự bảng chữ cái; thứ tự chúng được hiển thị không có tầm quan trọng thực sự.

Bạn cũng có thể tìm kiếm các thẻ khớp với một mẫu cụ thể.
Ví dụ, kho nguồn Git chứa hơn 500 thẻ.
Nếu bạn chỉ quan tâm đến việc xem chuỗi 1.8.5, bạn có thể chạy lệnh này:

[source,console]
----
$ git tag -l "v1.8.5*"
v1.8.5
v1.8.5-rc0
v1.8.5-rc1
v1.8.5-rc2
v1.8.5-rc3
v1.8.5.1
v1.8.5.2
v1.8.5.3
v1.8.5.4
v1.8.5.5
----

[NOTE]
.Liệt kê ký tự đại diện thẻ yêu cầu tùy chọn `-l` hoặc `--list`
====
Nếu bạn chỉ muốn toàn bộ danh sách các thẻ, chạy lệnh `git tag` ngầm giả định bạn muốn một danh sách và cung cấp một; việc sử dụng `-l` hoặc `--list` trong trường hợp này là tùy chọn.

Tuy nhiên, nếu bạn đang cung cấp một mẫu ký tự đại diện để khớp tên thẻ, việc sử dụng `-l` hoặc `--list` là bắt buộc.
====

==== Tạo Thẻ

Git hỗ trợ hai loại thẻ: _lightweight_ (nhẹ) và _annotated_ (chú thích).

Thẻ nhẹ rất giống một nhánh không thay đổi -- nó chỉ là một con trỏ đến một commit cụ thể.

Tuy nhiên, các thẻ chú thích được lưu trữ dưới dạng các đối tượng đầy đủ trong cơ sở dữ liệu Git.
Chúng được kiểm tra tổng kiểm tra; chứa tên người gắn thẻ, email và ngày; có thông điệp gắn thẻ; và có thể được ký và xác minh bằng GNU Privacy Guard (GPG).
Thường được khuyến nghị rằng bạn tạo các thẻ chú thích để bạn có thể có tất cả thông tin này; nhưng nếu bạn muốn một thẻ tạm thời hoặc vì lý do nào đó không muốn giữ thông tin khác, các thẻ nhẹ cũng có sẵn.

[[_annotated_tags]]
==== Thẻ Chú thích

(((tags, annotated)))
Tạo một thẻ chú thích trong Git rất đơn giản.
Cách dễ nhất là chỉ định `-a` khi bạn chạy lệnh `tag`:(((git commands, tag)))

[source,console]
----
$ git tag -a v1.4 -m "my version 1.4"
$ git tag
v0.1
v1.3
v1.4
----

`-m` chỉ định một thông điệp gắn thẻ, được lưu trữ cùng với thẻ.
Nếu bạn không chỉ định thông điệp cho một thẻ chú thích, Git sẽ khởi chạy trình soạn thảo của bạn để bạn có thể nhập nó vào.

Bạn có thể thấy dữ liệu thẻ cùng với commit đã được gắn thẻ bằng cách sử dụng lệnh `git show`:

[source,console]
----
$ git show v1.4
tag v1.4
Tagger: Ben Straub <ben@straub.cc>
Date:   Sat May 3 20:19:12 2014 -0700

my version 1.4

commit ca82a6dff817ec66f44342007202690a93763949
Author: Scott Chacon <schacon@gee-mail.com>
Date:   Mon Mar 17 21:52:11 2008 -0700

    Change version number
----

Điều đó hiển thị thông tin người gắn thẻ, ngày commit được gắn thẻ và thông điệp chú thích trước khi hiển thị thông tin commit.

==== Thẻ Nhẹ

(((tags, lightweight)))
Một cách khác để gắn thẻ commit là với một thẻ nhẹ.
Về cơ bản đây là tổng kiểm tra commit được lưu trữ trong một tệp -- không có thông tin khác được giữ lại.
Để tạo một thẻ nhẹ, đừng cung cấp bất kỳ tùy chọn `-a`, `-s` hoặc `-m` nào, chỉ cung cấp tên thẻ:

[source,console]
----
$ git tag v1.4-lw
$ git tag
v0.1
v1.3
v1.4
v1.4-lw
v1.5
----

Lần này, nếu bạn chạy `git show` trên thẻ, bạn không thấy thông tin thẻ bổ sung.(((git commands, show)))
Lệnh chỉ hiển thị commit:

[source,console]
----
$ git show v1.4-lw
commit ca82a6dff817ec66f44342007202690a93763949
Author: Scott Chacon <schacon@gee-mail.com>
Date:   Mon Mar 17 21:52:11 2008 -0700

    Change version number
----

==== Gắn Thẻ Sau

Bạn cũng có thể gắn thẻ commit sau khi bạn đã di chuyển qua chúng.
Giả sử lịch sử commit của bạn trông như thế này:

[source,console]
----
$ git log --pretty=oneline
15027957951b64cf874c3557a0f3547bd83b3ff6 Merge branch 'experiment'
a6b4c97498bd301d84096da251c98a07c7723e65 Create write support
0d52aaab4479697da7686c15f77a3d64d9165190 One more thing
6d52a271eda8725415634dd79daabbc4d9b6008e Merge branch 'experiment'
0b7434d86859cc7b8c3d5e1dddfed66ff742fcbc Add commit function
4682c3261057305bdd616e23b64b0857d832627b Add todo file
166ae0c4d3f420721acbb115cc33848dfcc2121a Create write support
9fceb02d0ae598e95dc970b74767f19372d61af8 Update rakefile
964f16d36dfccde844893cac5b347e7b3d44abbc Commit the todo
8a5cbc430f1a9c3d00faaeffd07798508422908a Update readme
----

Bây giờ, giả sử bạn quên gắn thẻ dự án tại v1.2, đó là tại commit "`Update rakefile`".
Bạn có thể thêm nó sau.
Để gắn thẻ commit đó, bạn chỉ định tổng kiểm tra commit (hoặc một phần của nó) ở cuối lệnh:

[source,console]
----
$ git tag -a v1.2 9fceb02
----

Bạn có thể thấy rằng bạn đã gắn thẻ commit:(((git commands, tag)))

[source,console]
----
$ git tag
v0.1
v1.2
v1.3
v1.4
v1.4-lw
v1.5

$ git show v1.2
tag v1.2
Tagger: Scott Chacon <schacon@gee-mail.com>
Date:   Mon Feb 9 15:32:16 2009 -0800

version 1.2
commit 9fceb02d0ae598e95dc970b74767f19372d61af8
Author: Magnus Chacon <mchacon@gee-mail.com>
Date:   Sun Apr 27 20:43:35 2008 -0700

    Update rakefile
...
----

[[_sharing_tags]]
==== Chia sẻ Thẻ

Theo mặc định, lệnh `git push` không chuyển thẻ đến máy chủ từ xa.(((git commands, push)))
Bạn sẽ phải đẩy thẻ một cách rõ ràng lên máy chủ chia sẻ sau khi bạn đã tạo chúng.
Quá trình này giống như chia sẻ các nhánh từ xa -- bạn có thể chạy `git push origin <tagname>`.

[source,console]
----
$ git push origin v1.5
Counting objects: 14, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (12/12), done.
Writing objects: 100% (14/14), 2.05 KiB | 0 bytes/s, done.
Total 14 (delta 3), reused 0 (delta 0)
To git@github.com:schacon/simplegit.git
 * [new tag]         v1.5 -> v1.5
----

Nếu bạn có nhiều thẻ mà bạn muốn đẩy lên cùng một lúc, bạn cũng có thể sử dụng tùy chọn `--tags` cho lệnh `git push`.
Điều này sẽ chuyển tất cả các thẻ của bạn lên máy chủ từ xa mà chưa có ở đó.

[source,console]
----
$ git push origin --tags
Counting objects: 1, done.
Writing objects: 100% (1/1), 160 bytes | 0 bytes/s, done.
Total 1 (delta 0), reused 0 (delta 0)
To git@github.com:schacon/simplegit.git
 * [new tag]         v1.4 -> v1.4
 * [new tag]         v1.4-lw -> v1.4-lw
----

Bây giờ, khi người khác sao chép hoặc kéo từ kho lưu trữ của bạn, họ cũng sẽ nhận được tất cả các thẻ của bạn.

[NOTE]
.`git push` đẩy cả hai loại thẻ
====
`git push <remote> --tags` sẽ đẩy cả thẻ nhẹ và thẻ chú thích.
Hiện tại không có tùy chọn nào để chỉ đẩy thẻ nhẹ, nhưng nếu bạn sử dụng `git push <remote> --follow-tags` chỉ các thẻ chú thích sẽ được đẩy lên remote.
====

==== Xóa Thẻ

Để xóa một thẻ trên kho lưu trữ cục bộ của bạn, bạn có thể sử dụng `git tag -d <tagname>`.
Ví dụ, chúng ta có thể xóa thẻ nhẹ của mình ở trên như sau:

[source,console]
----
$ git tag -d v1.4-lw
Deleted tag 'v1.4-lw' (was e7d5add)
----

Lưu ý rằng điều này không xóa thẻ khỏi bất kỳ máy chủ từ xa nào.
Có hai biến thể phổ biến để xóa một thẻ khỏi máy chủ từ xa.

Biến thể đầu tiên là `git push <remote> :refs/tags/<tagname>`:

[source,console]
----
$ git push origin :refs/tags/v1.4-lw
To /git@github.com:schacon/simplegit.git
 - [deleted]         v1.4-lw
----

Cách để hiểu điều trên là đọc nó như giá trị null trước dấu hai chấm đang được đẩy lên tên thẻ từ xa, xóa nó một cách hiệu quả.

Cách thứ hai (và trực quan hơn) để xóa một thẻ từ xa là với:

[source,console]
----
$ git push origin --delete <tagname>
----

==== Kiểm xuất Thẻ

Nếu bạn muốn xem các phiên bản của tệp mà một thẻ đang trỏ đến, bạn có thể thực hiện `git checkout` của thẻ đó, mặc dù điều này đặt kho lưu trữ của bạn vào trạng thái "`detached HEAD`", có một số tác dụng phụ không tốt:

[source,console]
----
$ git checkout v2.0.0
Note: switching to 'v2.0.0'.

You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by performing another checkout.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -c with the switch command. Example:

  git switch -c <new-branch-name>

Or undo this operation with:

  git switch -

Turn off this advice by setting config variable advice.detachedHead to false

HEAD is now at 99ada87... Merge pull request #89 from schacon/appendix-final

$ git checkout v2.0-beta-0.1
Previous HEAD position was 99ada87... Merge pull request #89 from schacon/appendix-final
HEAD is now at df3f601... Add atlas.json and cover image
----

Trong trạng thái "`detached HEAD`", nếu bạn thực hiện thay đổi và sau đó tạo một commit, thẻ sẽ giữ nguyên, nhưng commit mới của bạn sẽ không thuộc về bất kỳ nhánh nào và sẽ không thể truy cập được, ngoại trừ bằng hash commit chính xác.
Do đó, nếu bạn cần thực hiện thay đổi -- giả sử bạn đang sửa lỗi trên một phiên bản cũ hơn, chẳng hạn -- bạn thường sẽ muốn tạo một nhánh:

[source,console]
----
$ git checkout -b version2 v2.0.0
Switched to a new branch 'version2'
----

Nếu bạn làm điều này và thực hiện một commit, nhánh `version2` của bạn sẽ hơi khác so với thẻ `v2.0.0` của bạn vì nó sẽ tiến lên với các thay đổi mới của bạn, vì vậy hãy cẩn thận.
