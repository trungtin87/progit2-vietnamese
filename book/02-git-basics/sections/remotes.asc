[[_remote_repos]]
=== Làm việc với Remotes

Để có thể cộng tác trên bất kỳ dự án Git nào, bạn cần biết cách quản lý các kho lưu trữ từ xa của mình.
Kho lưu trữ từ xa là các phiên bản của dự án của bạn được lưu trữ trên Internet hoặc mạng ở đâu đó.
Bạn có thể có một số trong số chúng, mỗi cái thường chỉ đọc hoặc đọc/ghi cho bạn.
Cộng tác với người khác liên quan đến việc quản lý các kho lưu trữ từ xa này và đẩy và kéo dữ liệu đến và từ chúng khi bạn cần chia sẻ công việc.
Quản lý kho lưu trữ từ xa bao gồm biết cách thêm kho lưu trữ từ xa, xóa các remote không còn hợp lệ, quản lý các nhánh từ xa khác nhau và xác định chúng là được theo dõi hay không, và hơn thế nữa.
Trong phần này, chúng ta sẽ đề cập đến một số kỹ năng quản lý từ xa này.

[NOTE]
.Kho lưu trữ từ xa có thể nằm trên máy cục bộ của bạn.
====
Hoàn toàn có thể bạn có thể làm việc với một kho lưu trữ "`từ xa`" trên thực tế nằm trên cùng một máy chủ với bạn.
Từ "`từ xa`" không nhất thiết ngụ ý rằng kho lưu trữ ở nơi khác trên mạng hoặc Internet, chỉ là nó ở nơi khác.
Làm việc với một kho lưu trữ từ xa như vậy vẫn sẽ liên quan đến tất cả các thao tác đẩy, kéo và lấy tiêu chuẩn như với bất kỳ remote nào khác.
====

==== Hiển thị Remotes của Bạn

Để xem bạn đã cấu hình máy chủ từ xa nào, bạn có thể chạy lệnh `git remote`.(((git commands, remote)))
Nó liệt kê các tên ngắn của mỗi remote handle bạn đã chỉ định.
Nếu bạn đã sao chép kho lưu trữ của mình, bạn ít nhất sẽ thấy `origin` -- đó là tên mặc định mà Git đặt cho máy chủ bạn đã sao chép từ đó:

[source,console]
----
$ git clone https://github.com/schacon/ticgit
Cloning into 'ticgit'...
remote: Reusing existing pack: 1857, done.
remote: Total 1857 (delta 0), reused 0 (delta 0)
Receiving objects: 100% (1857/1857), 374.35 KiB | 268.00 KiB/s, done.
Resolving deltas: 100% (772/772), done.
Checking connectivity... done.
$ cd ticgit
$ git remote
origin
----

Bạn cũng có thể chỉ định `-v`, hiển thị cho bạn các URL mà Git đã lưu trữ cho tên ngắn để được sử dụng khi đọc và ghi vào remote đó:

[source,console]
----
$ git remote -v
origin	https://github.com/schacon/ticgit (fetch)
origin	https://github.com/schacon/ticgit (push)
----

Nếu bạn có nhiều hơn một remote, lệnh sẽ liệt kê tất cả chúng.
Ví dụ, một kho lưu trữ với nhiều remote để làm việc với một số cộng tác viên có thể trông giống như thế này.

[source,console]
----
$ cd grit
$ git remote -v
bakkdoor  https://github.com/bakkdoor/grit (fetch)
bakkdoor  https://github.com/bakkdoor/grit (push)
cho45     https://github.com/cho45/grit (fetch)
cho45     https://github.com/cho45/grit (push)
defunkt   https://github.com/defunkt/grit (fetch)
defunkt   https://github.com/defunkt/grit (push)
koke      git://github.com/koke/grit.git (fetch)
koke      git://github.com/koke/grit.git (push)
origin    git@github.com:mojombo/grit.git (fetch)
origin    git@github.com:mojombo/grit.git (push)
----

Điều này có nghĩa là chúng ta có thể kéo đóng góp từ bất kỳ người dùng nào trong số này khá dễ dàng.
Chúng ta có thể có thêm quyền đẩy lên một hoặc nhiều trong số này, mặc dù chúng ta không thể biết điều đó ở đây.

Lưu ý rằng các remote này sử dụng nhiều giao thức khác nhau; chúng ta sẽ đề cập thêm về điều này trong <<ch04-git-on-the-server#_getting_git_on_a_server>>.

==== Thêm Kho lưu trữ Từ xa

Chúng tôi đã đề cập và đưa ra một số minh họa về cách lệnh `git clone` ngầm thêm remote `origin` cho bạn.
Đây là cách thêm một remote mới một cách rõ ràng.(((git commands, remote)))
Để thêm một kho lưu trữ Git từ xa mới làm tên ngắn bạn có thể tham chiếu dễ dàng, hãy chạy `git remote add <shortname> <url>`:

[source,console]
----
$ git remote
origin
$ git remote add pb https://github.com/paulboone/ticgit
$ git remote -v
origin	https://github.com/schacon/ticgit (fetch)
origin	https://github.com/schacon/ticgit (push)
pb	https://github.com/paulboone/ticgit (fetch)
pb	https://github.com/paulboone/ticgit (push)
----

Bây giờ bạn có thể sử dụng chuỗi `pb` trên dòng lệnh thay vì toàn bộ URL.
Ví dụ, nếu bạn muốn lấy tất cả thông tin mà Paul có nhưng bạn chưa có trong kho lưu trữ của mình, bạn có thể chạy `git fetch pb`:

[source,console]
----
$ git fetch pb
remote: Counting objects: 43, done.
remote: Compressing objects: 100% (36/36), done.
remote: Total 43 (delta 10), reused 31 (delta 5)
Unpacking objects: 100% (43/43), done.
From https://github.com/paulboone/ticgit
 * [new branch]      master     -> pb/master
 * [new branch]      ticgit     -> pb/ticgit
----

Nhánh `master` của Paul bây giờ có thể truy cập cục bộ dưới dạng `pb/master` -- bạn có thể hợp nhất nó vào một trong các nhánh của mình, hoặc bạn có thể kiểm xuất một nhánh cục bộ tại thời điểm đó nếu bạn muốn kiểm tra nó.
Chúng ta sẽ xem xét các nhánh là gì và cách sử dụng chúng chi tiết hơn nhiều trong <<ch03-git-branching#ch03-git-branching>>.

[[_fetching_and_pulling]]
==== Lấy và Kéo từ Remotes của Bạn

Như bạn vừa thấy, để lấy dữ liệu từ các dự án từ xa của bạn, bạn có thể chạy:(((git commands, fetch)))

[source,console]
----
$ git fetch <remote>
----

Lệnh này đi ra dự án từ xa đó và kéo xuống tất cả dữ liệu từ dự án từ xa đó mà bạn chưa có.
Sau khi bạn làm điều này, bạn sẽ có tham chiếu đến tất cả các nhánh từ remote đó, mà bạn có thể hợp nhất hoặc kiểm tra bất cứ lúc nào.

Nếu bạn sao chép một kho lưu trữ, lệnh sẽ tự động thêm kho lưu trữ từ xa đó dưới tên "`origin`".
Vì vậy, `git fetch origin` lấy bất kỳ công việc mới nào đã được đẩy lên máy chủ đó kể từ khi bạn sao chép (hoặc lần cuối lấy từ) nó.
Điều quan trọng cần lưu ý là lệnh `git fetch` chỉ tải xuống dữ liệu vào kho lưu trữ cục bộ của bạn -- nó không tự động hợp nhất nó với bất kỳ công việc nào của bạn hoặc sửa đổi những gì bạn đang làm việc hiện tại.
Bạn phải hợp nhất nó theo cách thủ công vào công việc của mình khi bạn sẵn sàng.

Nếu nhánh hiện tại của bạn được thiết lập để theo dõi một nhánh từ xa (xem phần tiếp theo và <<ch03-git-branching#ch03-git-branching>> để biết thêm thông tin), bạn có thể sử dụng lệnh `git pull` để tự động lấy và sau đó hợp nhất nhánh từ xa đó vào nhánh hiện tại của bạn.(((git commands, pull)))
Đây có thể là một quy trình làm việc dễ dàng hơn hoặc thoải mái hơn cho bạn; và theo mặc định, lệnh `git clone` tự động thiết lập nhánh `master` cục bộ của bạn để theo dõi nhánh `master` từ xa (hoặc bất kỳ tên nhánh mặc định nào được gọi) trên máy chủ bạn đã sao chép từ đó.
Chạy `git pull` thường lấy dữ liệu từ máy chủ bạn ban đầu sao chép từ đó và tự động cố gắng hợp nhất nó vào mã bạn đang làm việc hiện tại.

[NOTE]
====
Từ phiên bản Git 2.27 trở đi, `git pull` sẽ đưa ra cảnh báo nếu biến `pull.rebase` không được đặt.
Git sẽ tiếp tục cảnh báo bạn cho đến khi bạn đặt biến.

Nếu bạn muốn hành vi mặc định của Git (fast-forward nếu có thể, nếu không tạo một commit hợp nhất):
`git config --global pull.rebase "false"`

Nếu bạn muốn rebase khi kéo:
`git config --global pull.rebase "true"`
====

[[_pushing_remotes]]
==== Đẩy lên Remotes của Bạn

Khi bạn có dự án của mình ở một điểm mà bạn muốn chia sẻ, bạn phải đẩy nó lên upstream.
Lệnh cho điều này rất đơn giản: `git push <remote> <branch>`.(((git commands, push)))
Nếu bạn muốn đẩy nhánh `master` của mình lên máy chủ `origin` của bạn (một lần nữa, việc sao chép thường thiết lập cả hai tên đó cho bạn tự động), thì bạn có thể chạy lệnh này để đẩy bất kỳ commit nào bạn đã thực hiện trở lại máy chủ:

[source,console]
----
$ git push origin master
----

Lệnh này chỉ hoạt động nếu bạn sao chép từ một máy chủ mà bạn có quyền ghi và nếu không ai đã đẩy trong thời gian chờ đợi.
Nếu bạn và người khác sao chép cùng một lúc và họ đẩy upstream và sau đó bạn đẩy upstream, việc đẩy của bạn sẽ bị từ chối một cách đúng đắn.
Bạn sẽ phải lấy công việc của họ trước và kết hợp nó vào của bạn trước khi bạn được phép đẩy.
Xem <<ch03-git-branching#ch03-git-branching>> để biết thêm thông tin chi tiết về cách đẩy lên máy chủ từ xa.

[[_inspecting_remote]]
==== Kiểm tra một Remote

Nếu bạn muốn xem thêm thông tin về một remote cụ thể, bạn có thể sử dụng lệnh `git remote show <remote>`.(((git commands, remote)))
Nếu bạn chạy lệnh này với một tên ngắn cụ thể, chẳng hạn như `origin`, bạn sẽ nhận được một cái gì đó như thế này:

[source,console]
----
$ git remote show origin
* remote origin
  Fetch URL: https://github.com/schacon/ticgit
  Push  URL: https://github.com/schacon/ticgit
  HEAD branch: master
  Remote branches:
    master                               tracked
    dev-branch                           tracked
  Local branch configured for 'git pull':
    master merges with remote master
  Local ref configured for 'git push':
    master pushes to master (up to date)
----

Nó liệt kê URL cho kho lưu trữ từ xa cũng như thông tin nhánh theo dõi.
Lệnh này hữu ích cho bạn biết rằng nếu bạn đang ở trên nhánh `master` và bạn chạy `git pull`, nó sẽ tự động hợp nhất nhánh `master` của remote vào nhánh cục bộ sau khi nó đã được lấy.
Nó cũng liệt kê tất cả các tham chiếu từ xa mà nó đã kéo xuống.

Đó là một ví dụ đơn giản mà bạn có thể gặp phải.
Tuy nhiên, khi bạn sử dụng Git nhiều hơn, bạn có thể thấy nhiều thông tin hơn từ `git remote show`:

[source,console]
----
$ git remote show origin
* remote origin
  URL: https://github.com/my-org/complex-project
  Fetch URL: https://github.com/my-org/complex-project
  Push  URL: https://github.com/my-org/complex-project
  HEAD branch: master
  Remote branches:
    master                           tracked
    dev-branch                       tracked
    markdown-strip                   tracked
    issue-43                         new (next fetch will store in remotes/origin)
    issue-45                         new (next fetch will store in remotes/origin)
    refs/remotes/origin/issue-11     stale (use 'git remote prune' to remove)
  Local branches configured for 'git pull':
    dev-branch merges with remote dev-branch
    master     merges with remote master
  Local refs configured for 'git push':
    dev-branch                     pushes to dev-branch                     (up to date)
    markdown-strip                 pushes to markdown-strip                 (up to date)
    master                         pushes to master                         (up to date)
----

Lệnh này hiển thị nhánh nào được tự động đẩy lên khi bạn chạy `git push` trong khi ở trên các nhánh nhất định.
Nó cũng cho bạn thấy những nhánh từ xa nào trên máy chủ mà bạn chưa có, những nhánh từ xa nào bạn có đã bị xóa khỏi máy chủ và nhiều nhánh cục bộ có thể tự động hợp nhất với nhánh theo dõi từ xa của chúng khi bạn chạy `git pull`.

==== Đổi tên và Xóa Remotes

Bạn có thể chạy `git remote rename` để thay đổi tên ngắn của một remote.(((git commands, remote)))
Ví dụ, nếu bạn muốn đổi tên `pb` thành `paul`, bạn có thể làm như vậy với `git remote rename`:

[source,console]
----
$ git remote rename pb paul
$ git remote
origin
paul
----

Đáng chú ý là điều này cũng thay đổi tất cả tên nhánh theo dõi từ xa của bạn.
Những gì từng được tham chiếu tại `pb/master` bây giờ ở `paul/master`.

Nếu bạn muốn xóa một remote vì lý do nào đó -- bạn đã di chuyển máy chủ hoặc không còn sử dụng một mirror cụ thể, hoặc có lẽ một người đóng góp không còn đóng góp nữa -- bạn có thể sử dụng `git remote remove` hoặc `git remote rm`:

[source,console]
----
$ git remote remove paul
$ git remote
origin
----

Khi bạn xóa tham chiếu đến một remote theo cách này, tất cả các nhánh theo dõi từ xa và cài đặt cấu hình liên quan đến remote đó cũng bị xóa.
