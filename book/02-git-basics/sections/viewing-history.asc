[[_viewing_history]]
=== Xem Lịch sử Cam kết

Sau khi bạn đã tạo một vài cam kết, hoặc nếu bạn đã sao chép một kho lưu trữ với lịch sử cam kết hiện có, bạn có thể sẽ muốn nhìn lại để xem những gì đã xảy ra.
Công cụ cơ bản và mạnh mẽ nhất để làm điều này là lệnh `git log`.

Các ví dụ này sử dụng một dự án rất đơn giản gọi là "`simplegit`".
Để lấy dự án, chạy:

[source,console]
----
$ git clone https://github.com/schacon/simplegit-progit
----

Khi bạn chạy `git log` trong dự án này, bạn sẽ nhận được đầu ra trông giống như thế này:(((git commands, log)))

[source,console]
----
$ git log
commit ca82a6dff817ec66f44342007202690a93763949
Author: Scott Chacon <schacon@gee-mail.com>
Date:   Mon Mar 17 21:52:11 2008 -0700

    Change version number

commit 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7
Author: Scott Chacon <schacon@gee-mail.com>
Date:   Sat Mar 15 16:40:33 2008 -0700

    Remove unnecessary test

commit a11bef06a3f659402fe7563abf99ad00de2209e6
Author: Scott Chacon <schacon@gee-mail.com>
Date:   Sat Mar 15 10:31:28 2008 -0700

    Initial commit
----

Theo mặc định, không có đối số, `git log` liệt kê các cam kết được thực hiện trong kho lưu trữ đó theo thứ tự thời gian ngược lại; nghĩa là, các cam kết gần đây nhất hiển thị đầu tiên.
Như bạn có thể thấy, lệnh này liệt kê mỗi cam kết với tổng kiểm tra SHA-1 của nó, tên và email của tác giả, ngày viết và thông điệp cam kết.

Một số lượng lớn và đa dạng các tùy chọn cho lệnh `git log` có sẵn để hiển thị cho bạn chính xác những gì bạn đang tìm kiếm.
Ở đây, chúng tôi sẽ chỉ cho bạn một số tùy chọn phổ biến nhất.

Một trong những tùy chọn hữu ích hơn là `-p` hoặc `--patch`, hiển thị sự khác biệt (đầu ra _patch_) được giới thiệu trong mỗi cam kết.
Bạn cũng có thể giới hạn số lượng mục nhật ký được hiển thị, chẳng hạn như sử dụng `-2` để chỉ hiển thị hai mục cuối cùng.

[source,console]
----
$ git log -p -2
commit ca82a6dff817ec66f44342007202690a93763949
Author: Scott Chacon <schacon@gee-mail.com>
Date:   Mon Mar 17 21:52:11 2008 -0700

    Change version number

diff --git a/Rakefile b/Rakefile
index a874b73..8f94139 100644
--- a/Rakefile
+++ b/Rakefile
@@ -5,7 +5,7 @@ require 'rake/gempackagetask'
 spec = Gem::Specification.new do |s|
     s.platform  =   Gem::Platform::RUBY
     s.name      =   "simplegit"
-    s.version   =   "0.1.0"
+    s.version   =   "0.1.1"
     s.author    =   "Scott Chacon"
     s.email     =   "schacon@gee-mail.com"
     s.summary   =   "A simple gem for using Git in Ruby code."

commit 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7
Author: Scott Chacon <schacon@gee-mail.com>
Date:   Sat Mar 15 16:40:33 2008 -0700

    Remove unnecessary test

diff --git a/lib/simplegit.rb b/lib/simplegit.rb
index a0a60ae..47c6340 100644
--- a/lib/simplegit.rb
+++ b/lib/simplegit.rb
@@ -18,8 +18,3 @@ class SimpleGit
     end

 end
-
-if $0 == __FILE__
-  git = SimpleGit.new
-  puts git.show
-end
----

Tùy chọn này hiển thị cùng một thông tin nhưng với một diff trực tiếp theo sau mỗi mục.
Điều này rất hữu ích cho việc xem xét mã hoặc để nhanh chóng duyệt những gì đã xảy ra trong một loạt các cam kết mà một cộng tác viên đã thêm vào.
Bạn cũng có thể sử dụng một loạt các tùy chọn tóm tắt với `git log`.
Ví dụ, nếu bạn muốn xem một số thống kê tóm tắt cho mỗi cam kết, bạn có thể sử dụng tùy chọn `--stat`:

[source,console]
----
$ git log --stat
commit ca82a6dff817ec66f44342007202690a93763949
Author: Scott Chacon <schacon@gee-mail.com>
Date:   Mon Mar 17 21:52:11 2008 -0700

    Change version number

 Rakefile | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7
Author: Scott Chacon <schacon@gee-mail.com>
Date:   Sat Mar 15 16:40:33 2008 -0700

    Remove unnecessary test

 lib/simplegit.rb | 5 -----
 1 file changed, 5 deletions(-)

commit a11bef06a3f659402fe7563abf99ad00de2209e6
Author: Scott Chacon <schacon@gee-mail.com>
Date:   Sat Mar 15 10:31:28 2008 -0700

    Initial commit

 README           |  6 ++++++
 Rakefile         | 23 +++++++++++++++++++++++
 lib/simplegit.rb | 25 +++++++++++++++++++++++++
 3 files changed, 54 insertions(+)
----

Như bạn có thể thấy, tùy chọn `--stat` in bên dưới mỗi mục cam kết một danh sách các tệp đã sửa đổi, bao nhiêu tệp đã thay đổi và bao nhiêu dòng trong các tệp đó đã được thêm và xóa.
Nó cũng đặt một bản tóm tắt thông tin ở cuối.

Một tùy chọn thực sự hữu ích khác là `--pretty`.
Tùy chọn này thay đổi đầu ra nhật ký sang các định dạng khác ngoài mặc định.
Một vài giá trị tùy chọn dựng sẵn có sẵn cho bạn sử dụng.
Giá trị `oneline` cho tùy chọn này in mỗi cam kết trên một dòng duy nhất, rất hữu ích nếu bạn đang xem xét rất nhiều cam kết.
Ngoài ra, các giá trị `short`, `full` và `fuller` hiển thị đầu ra theo định dạng gần giống nhau nhưng với ít hoặc nhiều thông tin hơn, tương ứng:

[source,console]
----
$ git log --pretty=oneline
ca82a6dff817ec66f44342007202690a93763949 Change version number
085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7 Remove unnecessary test
a11bef06a3f659402fe7563abf99ad00de2209e6 Initial commit
----

Giá trị tùy chọn thú vị nhất là `format`, cho phép bạn chỉ định định dạng đầu ra nhật ký của riêng mình.
Điều này đặc biệt hữu ích khi bạn đang tạo đầu ra cho máy phân tích cú pháp -- bởi vì bạn chỉ định định dạng một cách rõ ràng, bạn biết nó sẽ không thay đổi với các bản cập nhật cho Git:(((log formatting)))

[source,console]
----
$ git log --pretty=format:"%h - %an, %ar : %s"
ca82a6d - Scott Chacon, 6 years ago : Change version number
085bb3b - Scott Chacon, 6 years ago : Remove unnecessary test
a11bef0 - Scott Chacon, 6 years ago : Initial commit
----

<<pretty_format>> liệt kê một số chỉ định hữu ích hơn mà `format` nhận.

[[pretty_format]]
.Các chỉ định hữu ích cho `git log --pretty=format`
[cols="1,4",options="header"]
|================================
| Chỉ định | Mô tả Đầu ra
| `%H`      | Hash cam kết
| `%h`      | Hash cam kết viết tắt
| `%T`      | Hash cây
| `%t`      | Hash cây viết tắt
| `%P`      | Hash cha
| `%p`      | Hash cha viết tắt
| `%an`     | Tên tác giả
| `%ae`     | Email tác giả
| `%ad`     | Ngày tác giả (định dạng tuân theo `--date=option`)
| `%ar`     | Ngày tác giả, tương đối
| `%cn`     | Tên người cam kết
| `%ce`     | Email người cam kết
| `%cd`     | Ngày người cam kết
| `%cr`     | Ngày người cam kết, tương đối
| `%s`      | Chủ đề
|================================

Bạn có thể tự hỏi sự khác biệt giữa _author_ (tác giả) và _committer_ (người cam kết) là gì.
Tác giả là người ban đầu viết công việc, trong khi người cam kết là người cuối cùng áp dụng công việc.
Vì vậy, nếu bạn gửi một bản vá cho một dự án và một trong những thành viên cốt lõi áp dụng bản vá, cả hai bạn đều nhận được tín dụng -- bạn là tác giả và thành viên cốt lõi là người cam kết.
Chúng ta sẽ đề cập đến sự phân biệt này một chút nữa trong <<ch05-distributed-git#ch05-distributed-git>>.

Các giá trị tùy chọn `oneline` và `format` đặc biệt hữu ích với một tùy chọn `log` khác gọi là `--graph`.
Tùy chọn này thêm một biểu đồ ASCII nhỏ đẹp hiển thị lịch sử nhánh và hợp nhất của bạn:

[source,console]
----
$ git log --pretty=format:"%h %s" --graph
* 2d3acf9 Ignore errors from SIGCHLD on trap
*  5e3ee11 Merge branch 'master' of https://github.com/dustin/grit.git
|\
| * 420eac9 Add method for getting the current branch
* | 30e367c Timeout code and tests
* | 5a09431 Add timeout protection to grit
* | e1193f8 Support for heads with slashes in them
|/
* d6016bc Require time for xmlschema
*  11d191e Merge branch 'defunkt' into local
----

Loại đầu ra này sẽ trở nên thú vị hơn khi chúng ta đi qua việc phân nhánh và hợp nhất trong chương tiếp theo.

Đó chỉ là một số tùy chọn định dạng đầu ra đơn giản cho `git log` -- còn rất nhiều tùy chọn khác.
<<log_options>> liệt kê các tùy chọn chúng ta đã đề cập cho đến nay, cũng như một số tùy chọn định dạng phổ biến khác có thể hữu ích, cùng với cách chúng thay đổi đầu ra của lệnh `log`.

[[log_options]]
.Các tùy chọn phổ biến cho `git log`
[cols="1,4",options="header"]
|================================
| Tùy chọn          | Mô tả
| `-p`              | Hiển thị bản vá được giới thiệu với mỗi cam kết.
| `--stat`          | Hiển thị thống kê cho các tệp được sửa đổi trong mỗi cam kết.
| `--shortstat`     | Chỉ hiển thị dòng thay đổi/chèn/xóa từ lệnh `--stat`.
| `--name-only`     | Hiển thị danh sách các tệp được sửa đổi sau thông tin cam kết.
| `--name-status`   | Hiển thị danh sách các tệp bị ảnh hưởng với thông tin thêm/sửa đổi/xóa cũng như vậy.
| `--abbrev-commit` | Chỉ hiển thị vài ký tự đầu tiên của tổng kiểm tra SHA-1 thay vì tất cả 40.
| `--relative-date` | Hiển thị ngày ở định dạng tương đối (ví dụ: "`2 weeks ago`") thay vì sử dụng định dạng ngày đầy đủ.
| `--graph`         | Hiển thị biểu đồ ASCII của lịch sử nhánh và hợp nhất bên cạnh đầu ra nhật ký.
| `--pretty`        | Hiển thị các cam kết ở định dạng thay thế. Các giá trị tùy chọn bao gồm `oneline`, `short`, `full`, `fuller` và `format` (nơi bạn chỉ định định dạng của riêng mình).
| `--oneline`       | Viết tắt cho `--pretty=oneline --abbrev-commit` được sử dụng cùng nhau.
|================================

==== Giới hạn Đầu ra Nhật ký

Ngoài các tùy chọn định dạng đầu ra, `git log` nhận một số tùy chọn giới hạn hữu ích; nghĩa là, các tùy chọn cho phép bạn chỉ hiển thị một tập hợp con các cam kết.
Bạn đã thấy một tùy chọn như vậy rồi -- tùy chọn `-2`, hiển thị chỉ hai cam kết cuối cùng.
Trên thực tế, bạn có thể thực hiện `-<n>`, trong đó `n` là bất kỳ số nguyên nào để hiển thị `n` cam kết cuối cùng.
Trong thực tế, bạn không có khả năng sử dụng điều đó thường xuyên, bởi vì Git theo mặc định chuyển tất cả đầu ra qua một máy nhắn tin để bạn chỉ thấy một trang đầu ra nhật ký tại một thời điểm.

Tuy nhiên, các tùy chọn giới hạn thời gian như `--since` và `--until` rất hữu ích.
Ví dụ, lệnh này lấy danh sách các cam kết được thực hiện trong hai tuần qua:

[source,console]
----
$ git log --since=2.weeks
----

Lệnh này hoạt động với rất nhiều định dạng -- bạn có thể chỉ định một ngày cụ thể như `"2008-01-15"`, hoặc một ngày tương đối như `"2 years 1 day 3 minutes ago"`.

Bạn cũng có thể lọc danh sách các cam kết khớp với một số tiêu chí tìm kiếm.
Tùy chọn `--author` cho phép bạn lọc theo một tác giả cụ thể và tùy chọn `--grep` cho phép bạn tìm kiếm các từ khóa trong các thông điệp cam kết.

[NOTE]
====
Bạn có thể chỉ định nhiều hơn một phiên bản của cả tiêu chí tìm kiếm `--author` và `--grep`, điều này sẽ giới hạn đầu ra cam kết cho các cam kết khớp với _bất kỳ_ mẫu `--author` nào và _bất kỳ_ mẫu `--grep` nào; tuy nhiên, việc thêm tùy chọn `--all-match` tiếp tục giới hạn đầu ra chỉ cho những cam kết khớp với _tất cả_ các mẫu `--grep`.
====

Một bộ lọc thực sự hữu ích khác là tùy chọn `-S` (thường được gọi là tùy chọn "`pickaxe`" của Git), lấy một chuỗi và chỉ hiển thị những cam kết đã thay đổi số lần xuất hiện của chuỗi đó.
Ví dụ, nếu bạn muốn tìm cam kết cuối cùng đã thêm hoặc xóa một tham chiếu đến một hàm cụ thể, bạn có thể gọi:

[source,console]
----
$ git log -S function_name
----

Tùy chọn thực sự hữu ích cuối cùng để chuyển đến `git log` dưới dạng bộ lọc là một đường dẫn.
Nếu bạn chỉ định một thư mục hoặc tên tệp, bạn có thể giới hạn đầu ra nhật ký cho các cam kết đã giới thiệu một thay đổi đối với các tệp đó.
Đây luôn là tùy chọn cuối cùng và thường được đặt trước bởi dấu gạch ngang kép (`--`) để tách các đường dẫn khỏi các tùy chọn:

[source,console]
----
$ git log -- path/to/file
----

Trong <<limit_options>> chúng tôi sẽ liệt kê các tùy chọn này và một vài tùy chọn phổ biến khác để bạn tham khảo.

[[limit_options]]
.Các tùy chọn để giới hạn đầu ra của `git log`
[cols="2,4",options="header"]
|================================
| Tùy chọn              | Mô tả
| `-<n>`                | Chỉ hiển thị n cam kết cuối cùng.
| `--since`, `--after`  | Giới hạn các cam kết cho những cam kết được thực hiện sau ngày chỉ định.
| `--until`, `--before` | Giới hạn các cam kết cho những cam kết được thực hiện trước ngày chỉ định.
| `--author`            | Chỉ hiển thị các cam kết trong đó mục tác giả khớp với chuỗi chỉ định.
| `--committer`         | Chỉ hiển thị các cam kết trong đó mục người cam kết khớp với chuỗi chỉ định.
| `--grep`              | Chỉ hiển thị các cam kết có thông điệp cam kết chứa chuỗi.
| `-S`                  | Chỉ hiển thị các cam kết thêm hoặc xóa mã khớp với chuỗi.
|================================

Ví dụ, nếu bạn muốn xem những cam kết nào sửa đổi các tệp kiểm tra trong lịch sử mã nguồn Git được cam kết bởi Junio Hamano trong tháng 10 năm 2008 và không phải là các cam kết hợp nhất, bạn có thể chạy một cái gì đó như thế này:(((log filtering)))

[source,console]
----
$ git log --pretty="%h - %s" --author='Junio C Hamano' --since="2008-10-01" \
   --before="2008-11-01" --no-merges -- t/
5610e3b - Fix testcase failure when extended attributes are in use
acd3b9e - Enhance hold_lock_file_for_{update,append}() API
f563754 - demonstrate breakage of detached checkout with symbolic link HEAD
d1a43f2 - reset --hard/read-tree --reset -u: remove unmerged new paths
51a94af - Fix "checkout --track -b newbranch" on detached HEAD
b0ad11e - pull: allow "git pull origin $something:$current_branch" into an unborn branch
----

Trong số gần 40.000 cam kết trong lịch sử mã nguồn Git, lệnh này hiển thị 6 cam kết khớp với các tiêu chí đó.

[TIP]
.Ngăn chặn việc hiển thị các cam kết hợp nhất
====
Tùy thuộc vào quy trình làm việc được sử dụng trong kho lưu trữ của bạn, có thể một tỷ lệ lớn các cam kết trong lịch sử nhật ký của bạn chỉ là các cam kết hợp nhất, thường không cung cấp nhiều thông tin.
Để ngăn chặn việc hiển thị các cam kết hợp nhất làm lộn xộn lịch sử nhật ký của bạn, chỉ cần thêm tùy chọn `log` `--no-merges`.
====
