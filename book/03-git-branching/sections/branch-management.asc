[[_branch_management]]
=== Quản lý Nhánh

(((branches, managing)))
Bây giờ bạn đã tạo, hợp nhất và xóa một số nhánh, hãy xem xét một số công cụ quản lý nhánh sẽ rất hữu ích khi bạn bắt đầu sử dụng các nhánh mọi lúc.

Lệnh `git branch` làm nhiều việc hơn là chỉ tạo và xóa các nhánh.(((git commands, branch)))
Nếu bạn chạy nó mà không có đối số, bạn sẽ nhận được một danh sách đơn giản các nhánh hiện tại của mình:

[source,console]
----
$ git branch
  iss53
* master
  testing
----

Lưu ý ký tự `*` đứng trước nhánh `master`: nó cho biết nhánh mà bạn hiện đang kiểm xuất (tức là nhánh mà `HEAD` trỏ đến).
Điều này có nghĩa là nếu bạn cam kết tại thời điểm này, nhánh `master` sẽ được di chuyển về phía trước với công việc mới của bạn.
Để xem cam kết cuối cùng trên mỗi nhánh, bạn có thể chạy `git branch -v`:

[source,console]
----
$ git branch -v
  iss53   93b412c Fix javascript issue
* master  7a98805 Merge branch 'iss53'
  testing 782fd34 Add scott to the author list in the readme
----

Các tùy chọn hữu ích `--merged` và `--no-merged` có thể lọc danh sách này thành các nhánh mà bạn đã hoặc chưa hợp nhất vào nhánh bạn đang ở hiện tại.
Để xem nhánh nào đã được hợp nhất vào nhánh bạn đang ở, bạn có thể chạy `git branch --merged`:

[source,console]
----
$ git branch --merged
  iss53
* master
----

Bởi vì bạn đã hợp nhất `iss53` trước đó, bạn thấy nó trong danh sách của mình.
Các nhánh trong danh sách này không có dấu `*` phía trước chúng thường là tốt để xóa bằng `git branch -d`; bạn đã kết hợp công việc của chúng vào một nhánh khác, vì vậy bạn sẽ không mất bất cứ thứ gì.

Để xem tất cả các nhánh chứa công việc bạn chưa hợp nhất, bạn có thể chạy `git branch --no-merged`:

[source,console]
----
$ git branch --no-merged
  testing
----

Điều này hiển thị nhánh khác của bạn.
Bởi vì nó chứa công việc chưa được hợp nhất, việc cố gắng xóa nó bằng `git branch -d` sẽ thất bại:

[source,console]
----
$ git branch -d testing
error: The branch 'testing' is not fully merged.
If you are sure you want to delete it, run 'git branch -D testing'.
----

Nếu bạn thực sự muốn xóa nhánh và mất công việc đó, bạn có thể buộc nó bằng `-D`, như thông báo hữu ích chỉ ra.

[TIP]
====
Các tùy chọn được mô tả ở trên, `--merged` và `--no-merged` sẽ, nếu không được cung cấp tên cam kết hoặc nhánh làm đối số, hiển thị cho bạn những gì, tương ứng, đã hợp nhất hoặc chưa hợp nhất vào nhánh _hiện tại_ của bạn.

Bạn luôn có thể cung cấp thêm một đối số để hỏi về trạng thái hợp nhất đối với một số nhánh khác mà không cần kiểm xuất nhánh khác đó trước, như trong, cái gì chưa được hợp nhất vào nhánh `master`?
[source,console]
----
$ git checkout testing
$ git branch --no-merged master
  topicA
  featureB
----
====

==== Thay đổi tên nhánh

[CAUTION]
====
Không đổi tên các nhánh vẫn đang được sử dụng bởi các cộng tác viên khác.
Không đổi tên một nhánh như master/main/mainline mà không đọc phần <<_changing_master>>.
====

Giả sử bạn có một nhánh được gọi là `bad-branch-name` và bạn muốn đổi tên nó thành `corrected-branch-name`, trong khi vẫn giữ tất cả lịch sử.
Bạn cũng muốn thay đổi tên nhánh trên remote (GitHub, GitLab, máy chủ khác).
Làm thế nào để bạn làm điều này?

Đổi tên nhánh cục bộ bằng lệnh `git branch --move`:

[source, console]
----
$ git branch --move bad-branch-name corrected-branch-name
----

Điều này thay thế `bad-branch-name` của bạn bằng `corrected-branch-name`, nhưng thay đổi này chỉ là cục bộ vào lúc này.
Để cho người khác thấy nhánh đã sửa trên remote, hãy đẩy nó:

[source,console]
----
$ git push --set-upstream origin corrected-branch-name
----

Bây giờ chúng ta sẽ xem xét ngắn gọn về nơi chúng ta đang ở hiện tại:

[source, console]
----
$ git branch --all
* corrected-branch-name
  main
  remotes/origin/bad-branch-name
  remotes/origin/corrected-branch-name
  remotes/origin/main
----

Lưu ý rằng bạn đang ở trên nhánh `corrected-branch-name` và nó có sẵn trên remote.
Tuy nhiên, nhánh có tên xấu cũng vẫn hiện diện ở đó nhưng bạn có thể xóa nó bằng cách thực hiện lệnh sau:

[source,console]
----
$ git push origin --delete bad-branch-name
----

Bây giờ tên nhánh xấu đã được thay thế hoàn toàn bằng tên nhánh đã sửa.

[[_changing_master]]
===== Thay đổi tên nhánh master

[WARNING]
====
Thay đổi tên của một nhánh như master/main/mainline/default sẽ phá vỡ các tích hợp, dịch vụ, tiện ích trợ giúp và tập lệnh xây dựng/phát hành mà kho lưu trữ của bạn sử dụng.
Trước khi bạn làm điều này, hãy chắc chắn rằng bạn tham khảo ý kiến với các cộng tác viên của mình.
Ngoài ra, hãy chắc chắn rằng bạn thực hiện tìm kiếm kỹ lưỡng qua repo của mình và cập nhật bất kỳ tham chiếu nào đến tên nhánh cũ trong mã và tập lệnh của bạn.
====

Đổi tên nhánh `master` cục bộ của bạn thành `main` bằng lệnh sau:

[source,console]
----
$ git branch --move master main
----

Không còn nhánh `master` cục bộ nữa, vì nó đã được đổi tên thành nhánh `main`.

Để cho người khác thấy nhánh `main` mới, bạn cần đẩy nó lên remote.
Điều này làm cho nhánh đã đổi tên có sẵn trên remote.

[source,console]
----
$ git push --set-upstream origin main
----

Bây giờ chúng ta kết thúc với trạng thái sau:

[source,console]
----
$ git branch --all
* main
  remotes/origin/HEAD -> origin/master
  remotes/origin/main
  remotes/origin/master
----

Nhánh `master` cục bộ của bạn đã biến mất, vì nó được thay thế bằng nhánh `main`.
Nhánh `main` hiện diện trên remote.
Tuy nhiên, nhánh `master` cũ vẫn hiện diện trên remote.
Các cộng tác viên khác sẽ tiếp tục sử dụng nhánh `master` làm cơ sở cho công việc của họ, cho đến khi bạn thực hiện thêm một số thay đổi.

Bây giờ bạn có thêm một vài nhiệm vụ trước mắt để hoàn thành quá trình chuyển đổi:

* Bất kỳ dự án nào phụ thuộc vào dự án này sẽ cần cập nhật mã và/hoặc cấu hình của chúng.
* Cập nhật bất kỳ tệp cấu hình trình chạy thử nghiệm nào.
* Điều chỉnh các tập lệnh xây dựng và phát hành.
* Chuyển hướng cài đặt trên máy chủ lưu trữ repo của bạn cho những thứ như nhánh mặc định của repo, quy tắc hợp nhất và những thứ khác khớp với tên nhánh.
* Cập nhật tham chiếu đến nhánh cũ trong tài liệu.
* Đóng hoặc hợp nhất bất kỳ yêu cầu kéo nào nhắm mục tiêu đến nhánh cũ.

Sau khi bạn đã thực hiện tất cả các tác vụ này và chắc chắn rằng nhánh `main` hoạt động giống như nhánh `master`, bạn có thể xóa nhánh `master`:

[source, console]
----
$ git push origin --delete master
----
