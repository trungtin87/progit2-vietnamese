Hãy cùng xem một ví dụ đơn giản về phân nhánh và hợp nhất với một quy trình làm việc mà bạn có thể sử dụng trong thế giới thực.
Bạn sẽ làm theo các bước sau:

1.  Làm một số công việc trên một trang web.
2.  Tạo một nhánh cho một câu chuyện người dùng mới mà bạn đang làm.
3.  Làm một số công việc trong nhánh đó.

Ở giai đoạn này, bạn sẽ nhận được một cuộc gọi rằng một vấn đề khác là khẩn cấp và bạn cần một bản vá nóng.
Bạn sẽ làm như sau:

1.  Chuyển về nhánh sản xuất của bạn.
2.  Tạo một nhánh để thêm bản vá nóng.
3.  Sau khi đã được kiểm tra, hãy hợp nhất nhánh vá nóng và đẩy lên sản xuất.
4.  Chuyển về câu chuyện người dùng ban đầu của bạn và tiếp tục làm việc.

[[_basic_branching]]
==== Phân nhánh Cơ bản

Đầu tiên, giả sử bạn đang làm việc trên dự án của mình và đã có một vài cam kết trên nhánh `master`.

.Một lịch sử cam kết ngắn và đơn giản
image::images/basic-branching-1.png[Một lịch sử cam kết ngắn và đơn giản]

Bạn đã quyết định rằng bạn sẽ làm việc trên vấn đề #53 trong bất kỳ hệ thống theo dõi vấn đề nào mà công ty bạn sử dụng.
Để tạo một nhánh mới và chuyển sang nó cùng một lúc, bạn có thể chạy lệnh `git checkout` với một công tắc `-b`:

[source,console]
----
$ git checkout -b iss53
Switched to a new branch "iss53"
----

Đây là cách viết tắt cho:

[source,console]
----
$ git branch iss53
$ git checkout iss53
----

.Tạo một con trỏ nhánh mới
image::images/basic-branching-2.png[Tạo một con trỏ nhánh mới]

Bạn làm một số công việc trên trang web của mình và cam kết các thay đổi của bạn.
Làm như vậy sẽ di chuyển nhánh `iss53` về phía trước, bởi vì bạn đã kiểm xuất nó (nghĩa là, `HEAD` của bạn đang trỏ đến nó):

[source,console]
----
$ vim index.html
$ git commit -a -m 'Thêm một chân trang mới [vấn đề 53]'
----

.Nhánh `iss53` đã di chuyển về phía trước với công việc của bạn
image::images/basic-branching-3.png[Nhánh `iss53` đã di chuyển về phía trước với công việc của bạn]

Bây giờ bạn nhận được cuộc gọi rằng có một vấn đề với trang web và bạn cần phải sửa nó ngay lập tức.
Với Git, bạn không cần phải triển khai bản vá của mình cùng với các thay đổi `iss53` bạn đã thực hiện, và bạn không cần phải nỗ lực nhiều để hoàn nguyên các thay đổi đó trước khi bạn có thể làm việc trên việc áp dụng bản vá của mình cho những gì đang có trong sản xuất.
Tất cả những gì bạn phải làm là chuyển về nhánh `master` của bạn.

Tuy nhiên, trước khi bạn làm điều đó, hãy lưu ý rằng nếu thư mục làm việc hoặc khu vực tổ chức của bạn có các thay đổi chưa được cam kết xung đột với nhánh bạn đang kiểm xuất, Git sẽ không cho phép bạn chuyển nhánh.
Tốt nhất là có một trạng thái làm việc sạch khi bạn chuyển nhánh.
Có nhiều cách để giải quyết vấn đề này (cụ thể là, cất giữ và sửa đổi cam kết) mà chúng ta sẽ đề cập sau này, trong <<_git_stashing>>.
Hiện tại, giả sử bạn đã cam kết tất cả các thay đổi của mình, vì vậy bạn có thể chuyển về nhánh `master` của mình:

[source,console]
----
$ git checkout master
Switched to branch 'master'
----

Tại thời điểm này, thư mục làm việc dự án của bạn ở trạng thái chính xác như trước khi bạn bắt đầu làm việc trên vấn đề #53, và bạn có thể tập trung vào bản vá nóng của mình.
Đây là một điểm quan trọng cần nhớ: khi bạn chuyển nhánh, Git đặt lại thư mục làm việc của bạn để trông giống như lần cuối cùng bạn cam kết trên nhánh đó.
Nó tự động thêm, xóa và sửa đổi các tệp để đảm bảo bản sao làm việc của bạn là những gì nhánh trông như thế nào trong lần cam kết cuối cùng của bạn với nó.

Tiếp theo, bạn có một bản vá nóng để thực hiện.
Hãy tạo một nhánh vá nóng để làm việc cho đến khi hoàn thành:

[source,console]
----
$ git checkout -b hotfix
Switched to a new branch 'hotfix'
$ vim index.html
$ git commit -a -m 'Sửa địa chỉ email bị hỏng'
[hotfix 1fb7853] Sửa địa chỉ email bị hỏng
 1 file changed, 2 insertions(+), 2 deletions(-)
----

.nhánh vá nóng dựa trên master
image::images/basic-branching-4.png[nhánh vá nóng dựa trên master]

Bạn có thể chạy các bài kiểm tra của mình, đảm bảo bản vá nóng là những gì bạn muốn, và sau đó hợp nhất nó trở lại vào nhánh `master` của bạn để triển khai vào sản xuất.
Bạn làm điều này với lệnh `git merge`:

[source,console]
----
$ git checkout master
$ git merge hotfix
Updating f42c576..3a0874c
Fast-forward
 index.html | 2 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)
----

Bạn sẽ nhận thấy cụm từ "`Fast-forward`" trong lần hợp nhất đó.
Bởi vì cam kết `C4` được trỏ đến bởi nhánh `hotfix` bạn đã hợp nhất vào trực tiếp ở phía trước của cam kết `C2` bạn đang ở, Git chỉ đơn giản di chuyển con trỏ về phía trước.
Nói cách khác, khi bạn cố gắng hợp nhất một cam kết với một cam kết có thể đạt được bằng cách theo dõi lịch sử của cam kết đầu tiên, Git đơn giản hóa mọi thứ bằng cách di chuyển con trỏ về phía trước vì không có công việc phân kỳ để hợp nhất với nhau -- điều này được gọi là "`fast-forward`".

Thay đổi của bạn bây giờ nằm trong ảnh chụp nhanh của cam kết được trỏ đến bởi nhánh `master`, và bạn có thể triển khai bản vá của mình.

.master được tua nhanh đến vá nóng
image::images/basic-branching-5.png[master được tua nhanh đến vá nóng]

Sau khi bản vá nóng siêu quan trọng của bạn được triển khai, bạn đã sẵn sàng để chuyển về công việc bạn đang làm trước khi bị gián đoạn.
Tuy nhiên, trước tiên bạn sẽ xóa nhánh `hotfix`, bởi vì bạn không còn cần nó nữa -- nhánh `master` trỏ đến cùng một nơi.
Bạn có thể xóa nó bằng tùy chọn `-d` cho `git branch`:

[source,console]
----
$ git branch -d hotfix
Deleted branch hotfix (was 3a0874c).
----

Bây giờ bạn có thể chuyển về nhánh đang trong quá trình làm việc cho vấn đề #53 và tiếp tục làm việc trên đó.

[source,console]
----
$ git checkout iss53
Switched to branch "iss53"
$ vim index.html
$ git commit -a -m 'Hoàn thành vấn đề 53'
[iss53 348574c] Hoàn thành vấn đề 53
 1 file changed, 1 insertion(+), 1 deletion(-)
----

.nhánh iss53 đã di chuyển về phía trước một cách độc lập
image::images/basic-branching-6.png[nhánh iss53 đã di chuyển về phía trước một cách độc lập]

Điều đáng chú ý ở đây là công việc bạn đã làm trong nhánh `hotfix` của bạn không được chứa trong các tệp trong nhánh `iss53` của bạn.
Nếu bạn cần kéo nó vào, bạn có thể hợp nhất nhánh `master` của bạn vào nhánh `iss53` của bạn bằng cách chạy `git merge master`, hoặc bạn có thể đợi để tích hợp các thay đổi đó cho đến khi bạn quyết định kéo nhánh `iss53` trở lại vào `master` sau này.

[[_basic_merging]]
==== Hợp nhất Cơ bản

Giả sử bạn đã quyết định rằng công việc vấn đề #53 của bạn đã hoàn thành và sẵn sàng để được hợp nhất vào nhánh `master` của bạn.
Để làm điều đó, bạn sẽ hợp nhất nhánh `iss53` của bạn vào `master`, giống như bạn đã hợp nhất nhánh `hotfix` của mình trước đó.
Tất cả những gì bạn phải làm là kiểm xuất nhánh bạn muốn hợp nhất vào và sau đó chạy lệnh `git merge`:

[source,console]
----
$ git checkout master
Switched to branch 'master'
$ git merge iss53
Merge made by the 'recursive' strategy.
index.html |    1 +
1 file changed, 1 insertion(+)
----

Điều này trông hơi khác so với việc hợp nhất `hotfix` bạn đã làm trước đó.
Trong trường hợp này, lịch sử phát triển của bạn đã phân kỳ từ một điểm cũ hơn.
Bởi vì cam kết trên nhánh bạn đang ở không phải là tổ tiên trực tiếp của nhánh bạn đang hợp nhất vào, Git phải làm một số việc.
Trong trường hợp này, Git thực hiện một hợp nhất ba chiều đơn giản, sử dụng hai ảnh chụp nhanh được trỏ đến bởi các đầu nhánh và tổ tiên chung của cả hai.

.Git tự động xác định cơ sở hợp nhất tổ tiên chung tốt nhất cho việc hợp nhất.
image::images/basic-merging-1.png[Git tự động xác định cơ sở hợp nhất tổ tiên chung tốt nhất cho việc hợp nhất.]

Thay vì chỉ di chuyển con trỏ nhánh về phía trước, Git tạo ra một ảnh chụp nhanh mới từ việc hợp nhất ba chiều này và tự động tạo ra một cam kết mới trỏ đến nó.
Điều này được gọi là một cam kết hợp nhất, và đặc biệt ở chỗ nó có nhiều hơn một cha mẹ.

.Một cam kết hợp nhất
image::images/basic-merging-2.png[Một cam kết hợp nhất]

Bây giờ công việc của bạn đã được hợp nhất, bạn không cần nhánh `iss53` nữa.
Bạn có thể đóng vấn đề trong hệ thống theo dõi vấn đề của mình và xóa nhánh:

[source,console]
----
$ git branch -d iss53
----

[[_basic_merge_conflicts]]
==== Xung đột Hợp nhất Cơ bản

(((merging, conflicts)))
Đôi khi, quá trình này không diễn ra suôn sẻ.
Nếu bạn đã thay đổi cùng một phần của cùng một tệp theo những cách khác nhau trong hai nhánh bạn đang hợp nhất, Git sẽ không thể hợp nhất chúng một cách sạch sẽ.
Nếu bản vá của bạn cho vấn đề #53 đã sửa đổi cùng một phần của một tệp như nhánh `hotfix`, bạn sẽ nhận được một xung đột hợp nhất trông giống như thế này:

[source,console]
----
$ git merge iss53
Auto-merging index.html
CONFLICT (content): Merge conflict in index.html
Automatic merge failed; fix conflicts and then commit the result.
----

Git đã không tự động tạo một cam kết hợp nhất mới.
Nó đã tạm dừng quá trình trong khi bạn giải quyết xung đột.
Nếu bạn muốn xem tệp nào chưa được hợp nhất tại bất kỳ thời điểm nào sau khi xảy ra xung đột hợp nhất, bạn có thể chạy `git status`:

[source,console]
----
$ git status
On branch master
You have unmerged paths.
  (fix conflicts and run "git commit")

Unmerged paths:
  (use "git add <file>..." to mark resolution)

    both modified:      index.html

no changes added to commit (use "git add" and/or "git commit -a")
----

Bất cứ thứ gì có xung đột hợp nhất và chưa được giải quyết đều được liệt kê là chưa hợp nhất.
Git thêm các điểm đánh dấu giải quyết xung đột tiêu chuẩn vào các tệp có xung đột, vì vậy bạn có thể mở chúng thủ công và giải quyết các xung đột đó.
Tệp của bạn chứa một phần trông giống như thế này:

[source,html]
----
<<<<<<< HEAD:index.html
<div id="footer">contact : email.support@github.com</div>
=======
<div id="footer">
 please contact us at support@github.com
</div>
>>>>>>> iss53:index.html
----

Điều này có nghĩa là phiên bản trong `HEAD` (nhánh `master` của bạn, bởi vì đó là những gì bạn đã kiểm xuất khi bạn chạy lệnh hợp nhất của mình) là phần trên cùng của khối đó (mọi thứ phía trên `=======`), trong khi phiên bản trong nhánh `iss53` của bạn trông giống như mọi thứ ở phần dưới cùng.
Để giải quyết xung đột, bạn phải chọn một bên hoặc bên kia hoặc tự hợp nhất nội dung.
Ví dụ: bạn có thể giải quyết xung đột này bằng cách thay thế toàn bộ khối bằng khối này:

[source,html]
----
<div id="footer">
please contact us at email.support@github.com
</div>
----

Giải pháp này có một chút của mỗi phần, và các dòng `<<<<<<<`, `=======` và `>>>>>>>` đã bị xóa hoàn toàn.
Sau khi bạn đã giải quyết từng phần này trong mỗi tệp bị xung đột, hãy chạy `git add` trên mỗi tệp để đánh dấu nó là đã giải quyết.
Tổ chức tệp đánh dấu nó là đã giải quyết trong Git.

Nếu bạn muốn sử dụng một công cụ đồ họa để giải quyết các vấn đề này, bạn có thể chạy `git mergetool`, công cụ này sẽ kích hoạt một công cụ hợp nhất trực quan thích hợp và hướng dẫn bạn qua các xung đột:(((git commands, mergetool)))

[source,console]
----
$ git mergetool

This message is displayed because 'merge.tool' is not configured.
See 'git mergetool --tool-help' or 'git help config' for more details.
'git mergetool' will now attempt to use one of the following tools:
opendiff kdiff3 tkdiff xxdiff meld tortoisemerge gvimdiff diffuse diffmerge ecmerge p4merge araxis bc3 codecompare vimdiff emerge
Merging:
index.html

Normal merge conflict for 'index.html':
  {local}: modified file
  {remote}: modified file
Hit return to start merge resolution tool (opendiff):
----

Nếu bạn muốn sử dụng một công cụ hợp nhất khác với mặc định (Git đã chọn `opendiff` trong trường hợp này vì lệnh được chạy trên macOS), bạn có thể thấy tất cả các công cụ được hỗ trợ được liệt kê ở trên cùng sau "`one of the following tools.`"
Chỉ cần nhập tên của công cụ bạn muốn sử dụng.

[NOTE]
====
Nếu bạn cần các công cụ nâng cao hơn để giải quyết các xung đột hợp nhất phức tạp, chúng tôi sẽ đề cập thêm về việc hợp nhất trong <<ch07-git-tools#_advanced_merging>>.
====

Sau khi bạn thoát khỏi công cụ hợp nhất, Git hỏi bạn xem việc hợp nhất có thành công không.
Nếu bạn nói với tập lệnh rằng đúng như vậy, nó sẽ tổ chức tệp để đánh dấu nó là đã giải quyết cho bạn.
Bạn có thể chạy `git status` một lần nữa để xác minh rằng tất cả các xung đột đã được giải quyết:

[source,console]
----
$ git status
On branch master
All conflicts fixed but you are still merging.
  (use "git commit" to conclude merge)

Changes to be committed:

    modified:   index.html
----

Nếu bạn hài lòng với điều đó, và bạn xác minh rằng mọi thứ có xung đột đã được tổ chức, bạn có thể nhập `git commit` để hoàn tất cam kết hợp nhất.
Thông điệp cam kết theo mặc định trông giống như thế này:

[source,console]
----
Merge branch 'iss53'

Conflicts:
    index.html
#
# It looks like you may be committing a merge.
# If this is not correct, please remove the file
#	.git/MERGE_HEAD
# and try again.


# Please enter the commit message for your changes. Lines starting
# with '#' will be ignored, and an empty message aborts the commit.
# On branch master
# All conflicts fixed but you are still merging.
#
# Changes to be committed:
#	modified:   index.html
#
----

Nếu bạn nghĩ rằng nó sẽ hữu ích cho những người khác xem xét việc hợp nhất này trong tương lai, bạn có thể sửa đổi thông điệp cam kết này với các chi tiết về cách bạn đã giải quyết việc hợp nhất và giải thích lý do tại sao bạn đã thực hiện các thay đổi bạn đã thực hiện nếu những điều này không rõ ràng.