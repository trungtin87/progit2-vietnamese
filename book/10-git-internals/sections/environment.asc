=== Biến Môi trường

Git luôn chạy bên trong một shell `bash`, và sử dụng một số biến môi trường shell để xác định cách nó hoạt động.
Thỉnh thoảng, sẽ hữu ích khi biết những biến này là gì, và cách chúng có thể được sử dụng để làm cho Git hoạt động theo cách bạn muốn.
Đây không phải là danh sách đầy đủ tất cả các biến môi trường mà Git chú ý đến, nhưng chúng tôi sẽ đề cập đến những biến hữu ích nhất.

==== Hành vi Toàn cục

Một số hành vi chung của Git như một chương trình máy tính phụ thuộc vào các biến môi trường.

*`GIT_EXEC_PATH`* xác định nơi Git tìm kiếm các chương trình con của nó (như `git-commit`, `git-diff`, và các chương trình khác).
Bạn có thể kiểm tra thiết lập hiện tại bằng cách chạy `git --exec-path`.

*`HOME`* thường không được coi là có thể tùy chỉnh (quá nhiều thứ khác phụ thuộc vào nó), nhưng đó là nơi Git tìm kiếm tập tin cấu hình toàn cục.
Nếu bạn muốn một cài đặt Git thực sự di động, hoàn chỉnh với cấu hình toàn cục, bạn có thể ghi đè `HOME` trong hồ sơ shell của Git di động.

*`PREFIX`* tương tự, nhưng cho cấu hình toàn hệ thống.
Git tìm kiếm tập tin này tại `$PREFIX/etc/gitconfig`.

*`GIT_CONFIG_NOSYSTEM`*, nếu được đặt, vô hiệu hóa việc sử dụng tập tin cấu hình toàn hệ thống.
Điều này hữu ích nếu cấu hình hệ thống của bạn đang can thiệp vào các lệnh của bạn, nhưng bạn không có quyền truy cập để thay đổi hoặc xóa nó.

*`GIT_PAGER`* kiểm soát chương trình được sử dụng để hiển thị đầu ra nhiều trang trên dòng lệnh.
Nếu điều này không được đặt, `PAGER` sẽ được sử dụng như một dự phòng.

*`GIT_EDITOR`* là trình soạn thảo mà Git sẽ khởi chđộng khi người dùng cần chỉnh sửa một số văn bản (một thông điệp commit, chẳng hạn).
Nếu không được đặt, `EDITOR` sẽ được sử dụng.

==== Vị trí Kho chứa

Git sử dụng một số biến môi trường để xác định cách nó giao tiếp với kho chứa hiện tại.

*`GIT_DIR`* là vị trí của thư mục `.git`.
Nếu điều này không được chỉ định, Git đi lên cây thư mục cho đến khi nó đến `~` hoặc `/`, tìm kiếm một thư mục `.git` ở mỗi bước.

*`GIT_CEILING_DIRECTORIES`* kiểm soát hành vi tìm kiếm một thư mục `.git`.
Nếu bạn truy cập các thư mục chậm để tải (chẳng hạn như những thư mục trên ổ băng, hoặc qua một kết nối mạng chậm), bạn có thể muốn Git ngừng thử sớm hơn so với nó có thể, đặc biệt nếu Git được gọi khi xây dựng dấu nhắc shell của bạn.

*`GIT_WORK_TREE`* là vị trí của gốc của thư mục làm việc cho một kho chứa không bare.
Nếu `--git-dir` hoặc `GIT_DIR` được chỉ định nhưng không có `--work-tree`, `GIT_WORK_TREE` hoặc `core.worktree` được chỉ định, thư mục làm việc hiện tại được coi là cấp cao nhất của cây làm việc của bạn.

*`GIT_INDEX_FILE`* là đường dẫn đến tập tin index (chỉ các kho chứa không bare).

*`GIT_OBJECT_DIRECTORY`* có thể được sử dụng để chỉ định vị trí của thư mục thường nằm tại `.git/objects`.

*`GIT_ALTERNATE_OBJECT_DIRECTORIES`* là một danh sách phân tách bằng dấu hai chấm (được định dạng như `/dir/one:/dir/two:…`) cho Git biết nơi kiểm tra các đối tượng nếu chúng không có trong `GIT_OBJECT_DIRECTORY`.
Nếu bạn tình cờ có nhiều dự án với các tập tin lớn có nội dung giống hệt nhau, điều này có thể được sử dụng để tránh lưu trữ quá nhiều bản sao của chúng.

==== Pathspecs

Một "`pathspec`" đề cập đến cách bạn chỉ định đường dẫn đến các thứ trong Git, bao gồm việc sử dụng ký tự đại diện.
Chúng được sử dụng trong tập tin `.gitignore`, nhưng cũng trên dòng lệnh (`git add *.c`).

*`GIT_GLOB_PATHSPECS`* và *`GIT_NOGLOB_PATHSPECS`* kiểm soát hành vi mặc định của ký tự đại diện trong pathspecs.
Nếu `GIT_GLOB_PATHSPECS` được đặt thành 1, các ký tự đại diện hoạt động như ký tự đại diện (đó là mặc định); nếu `GIT_NOGLOB_PATHSPECS` được đặt thành 1, các ký tự đại diện chỉ khớp với chính chúng, có nghĩa là một cái gì đó như `\\*.c` sẽ chỉ khớp với một tập tin _có tên_ "`\\*.c`", thay vì bất kỳ tập tin nào có tên kết thúc bằng `.c`.
Bạn có thể ghi đè điều này trong các trường hợp riêng lẻ bằng cách bắt đầu pathspec với `:(glob)` hoặc `:(literal)`, như trong `:(glob)\\*.c`.

*`GIT_LITERAL_PATHSPECS`* vô hiệu hóa cả hai hành vi trên; không có ký tự đại diện nào sẽ hoạt động, và các tiền tố ghi đè cũng bị vô hiệu hóa.

*`GIT_ICASE_PATHSPECS`* đặt tất cả pathspecs hoạt động theo cách không phân biệt chữ hoa chữ thường.

==== Commit

Việc tạo cuối cùng của một đối tượng commit Git thường được thực hiện bởi `git-commit-tree`, sử dụng các biến môi trường này làm nguồn thông tin chính của nó, chỉ quay lại các giá trị cấu hình nếu những biến này không có.

*`GIT_AUTHOR_NAME`* là tên có thể đọc được của con người trong trường "`author`".

*`GIT_AUTHOR_EMAIL`* là email cho trường "`author`".

*`GIT_AUTHOR_DATE`* là dấu thời gian được sử dụng cho trường "`author`".

*`GIT_COMMITTER_NAME`* đặt tên con người cho trường "`committer`".

*`GIT_COMMITTER_EMAIL`* là địa chỉ email cho trường "`committer`".

*`GIT_COMMITTER_DATE`* được sử dụng cho dấu thời gian trong trường "`committer`".

*`EMAIL`* là địa chỉ email dự phòng trong trường hợp giá trị cấu hình `user.email` không được đặt.
Nếu _điều này_ không được đặt, Git quay lại tên người dùng và máy chủ hệ thống.

==== Mạng

Git sử dụng thư viện `curl` để thực hiện các thao tác mạng qua HTTP, vì vậy *`GIT_CURL_VERBOSE`* bảo Git phát ra tất cả các thông điệp được tạo bởi thư viện đó.
Điều này tương tự như thực hiện `curl -v` trên dòng lệnh.

*`GIT_SSL_NO_VERIFY`* bảo Git không xác minh chứng chỉ SSL.
Điều này đôi khi có thể cần thiết nếu bạn đang sử dụng một chứng chỉ tự ký để phục vụ các kho chứa Git qua HTTPS, hoặc bạn đang ở giữa việc thiết lập một máy chủ Git nhưng chưa cài đặt một chứng chỉ đầy đủ.

Nếu tốc độ dữ liệu của một thao tác HTTP thấp hơn *`GIT_HTTP_LOW_SPEED_LIMIT`* byte mỗi giây trong thời gian dài hơn *`GIT_HTTP_LOW_SPEED_TIME`* giây, Git sẽ hủy bỏ thao tác đó.
Các giá trị này ghi đè các giá trị cấu hình `http.lowSpeedLimit` và `http.lowSpeedTime`.

*`GIT_HTTP_USER_AGENT`* đặt chuỗi user-agent được sử dụng bởi Git khi giao tiếp qua HTTP.
Mặc định là một giá trị như `git/2.0.0`.

==== Diffing và Merging

*`GIT_DIFF_OPTS`* là một chút sai tên.
Các giá trị hợp lệ duy nhất là `-u<n>` hoặc `--unified=<n>`, kiểm soát số dòng ngữ cảnh được hiển thị trong một lệnh `git diff`.

*`GIT_EXTERNAL_DIFF`* được sử dụng như một ghi đè cho giá trị cấu hình `diff.external`.
Nếu nó được đặt, Git sẽ gọi chương trình này khi `git diff` được gọi.

*`GIT_DIFF_PATH_COUNTER`* và *`GIT_DIFF_PATH_TOTAL`* hữu ích từ bên trong chương trình được chỉ định bởi `GIT_EXTERNAL_DIFF` hoặc `diff.external`.
Cái trước đại diện cho tập tin nào trong một loạt đang được diff (bắt đầu với 1), và cái sau là tổng số tập tin trong lô.

*`GIT_MERGE_VERBOSITY`* kiểm soát đầu ra cho chiến lược trộn đệ quy.
Các giá trị được phép như sau:

* 0 không xuất ra gì, ngoại trừ có thể một thông điệp lỗi duy nhất.
* 1 chỉ hiển thị xung đột.
* 2 cũng hiển thị các thay đổi tập tin.
* 3 hiển thị khi các tập tin bị bỏ qua vì chúng không thay đổi.
* 4 hiển thị tất cả các đường dẫn khi chúng được xử lý.
* 5 trở lên hiển thị thông tin gỡ lỗi chi tiết.

Giá trị mặc định là 2.

==== Gỡ lỗi

Bạn muốn _thực sự_ biết Git đang làm gì?
Git có một bộ dấu vết khá đầy đủ được nhúng, và tất cả những gì bạn cần làm là bật chúng lên.
Các giá trị có thể có của các biến này như sau:

* "`true`", "`1`", hoặc "`2`" – danh mục dấu vết được ghi vào stderr.
* Một đường dẫn tuyệt đối bắt đầu bằng `/` – đầu ra dấu vết sẽ được ghi vào tập tin đó.

*`GIT_TRACE`* kiểm soát các dấu vết chung, không phù hợp với bất kỳ danh mục cụ thể nào.
Điều này bao gồm việc mở rộng các bí danh, và ủy quyền cho các chương trình con khác.

[source,console]
----
$ GIT_TRACE=true git lga
20:12:49.877982 git.c:554               trace: exec: 'git-lga'
20:12:49.878369 run-command.c:341       trace: run_command: 'git-lga'
20:12:49.879529 git.c:282               trace: alias expansion: lga => 'log' '--graph' '--pretty=oneline' '--abbrev-commit' '--decorate' '--all'
20:12:49.879885 git.c:349               trace: built-in: git 'log' '--graph' '--pretty=oneline' '--abbrev-commit' '--decorate' '--all'
20:12:49.899217 run-command.c:341       trace: run_command: 'less'
20:12:49.899675 run-command.c:192       trace: exec: 'less'
----

*`GIT_TRACE_PACK_ACCESS`* kiểm soát dấu vết truy cập packfile.
Trường đầu tiên là packfile đang được truy cập, trường thứ hai là offset trong tập tin đó:

[source,console]
----
$ GIT_TRACE_PACK_ACCESS=true git status
20:10:12.081397 sha1_file.c:2088        .git/objects/pack/pack-c3fa...291e.pack 12
20:10:12.081886 sha1_file.c:2088        .git/objects/pack/pack-c3fa...291e.pack 34662
20:10:12.082115 sha1_file.c:2088        .git/objects/pack/pack-c3fa...291e.pack 35175
# […]
20:10:12.087398 sha1_file.c:2088        .git/objects/pack/pack-e80e...e3d2.pack 56914983
20:10:12.087419 sha1_file.c:2088        .git/objects/pack/pack-e80e...e3d2.pack 14303666
On branch master
Your branch is up-to-date with 'origin/master'.
nothing to commit, working directory clean
----

*`GIT_TRACE_PACKET`* cho phép dấu vết cấp gói cho các thao tác mạng.

[source,console]
----
$ GIT_TRACE_PACKET=true git ls-remote origin
20:15:14.867043 pkt-line.c:46           packet:          git< # service=git-upload-pack
20:15:14.867071 pkt-line.c:46           packet:          git< 0000
20:15:14.867079 pkt-line.c:46           packet:          git< 97b8860c071898d9e162678ea1035a8ced2f8b1f HEAD\\0multi_ack thin-pack side-band side-band-64k ofs-delta shallow no-progress include-tag multi_ack_detailed no-done symref=HEAD:refs/heads/master agent=git/2.0.4
20:15:14.867088 pkt-line.c:46           packet:          git< 0f20ae29889d61f2e93ae00fd34f1cdb53285702 refs/heads/ab/add-interactive-show-diff-func-name
20:15:14.867094 pkt-line.c:46           packet:          git< 36dc827bc9d17f80ed4f326de21247a5d1341fbc refs/heads/ah/doc-gitk-config
# […]
----

*`GIT_TRACE_PERFORMANCE`* kiểm soát ghi nhật ký dữ liệu hiệu suất.
Đầu ra hiển thị mỗi lệnh gọi `git` cụ thể mất bao lâu.

[source,console]
----
$ GIT_TRACE_PERFORMANCE=true git gc
20:18:19.499676 trace.c:414             performance: 0.374835000 s: git command: 'git' 'pack-refs' '--all' '--prune'
20:18:19.845585 trace.c:414             performance: 0.343020000 s: git command: 'git' 'reflog' 'expire' '--all'
Counting objects: 170994, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (43413/43413), done.
Writing objects: 100% (170994/170994), done.
Total 170994 (delta 126176), reused 170524 (delta 125706)
20:18:23.567927 trace.c:414             performance: 3.715349000 s: git command: 'git' 'pack-objects' '--keep-true-parents' '--honor-pack-keep' '--non-empty' '--all' '--reflog' '--unpack-unreachable=2.weeks.ago' '--local' '--delta-base-offset' '.git/objects/pack/.tmp-49190-pack'
20:18:23.584728 trace.c:414             performance: 0.000910000 s: git command: 'git' 'prune-packed'
20:18:23.605218 trace.c:414             performance: 0.017972000 s: git command: 'git' 'update-server-info'
20:18:23.606342 trace.c:414             performance: 3.756312000 s: git command: 'git' 'repack' '-d' '-l' '-A' '--unpack-unreachable=2.weeks.ago'
Checking connectivity: 170994, done.
20:18:25.225424 trace.c:414             performance: 1.616423000 s: git command: 'git' 'prune' '--expire' '2.weeks.ago'
20:18:25.232403 trace.c:414             performance: 0.001051000 s: git command: 'git' 'rerere' 'gc'
20:18:25.233159 trace.c:414             performance: 6.112217000 s: git command: 'git' 'gc'
----

*`GIT_TRACE_SETUP`* hiển thị thông tin về những gì Git đang khám phá về kho chứa và môi trường mà nó đang tương tác.

[source,console]
----
$ GIT_TRACE_SETUP=true git status
20:19:47.086765 trace.c:315             setup: git_dir: .git
20:19:47.087184 trace.c:316             setup: worktree: /Users/ben/src/git
20:19:47.087191 trace.c:317             setup: cwd: /Users/ben/src/git
20:19:47.087194 trace.c:318             setup: prefix: (null)
On branch master
Your branch is up-to-date with 'origin/master'.
nothing to commit, working directory clean
----

==== Khác

*`GIT_SSH`*, nếu được chỉ định, là một chương trình được gọi thay vì `ssh` khi Git cố gắng kết nối đến một máy chủ SSH.
Nó được gọi như `$GIT_SSH [username@]host [-p <port>] <command>`.
Lưu ý rằng đây không phải là cách dễ nhất để tùy chỉnh cách `ssh` được gọi; nó sẽ không hỗ trợ các tham số dòng lệnh bổ sung.
Để hỗ trợ các tham số dòng lệnh bổ sung, bạn có thể sử dụng *`GIT_SSH_COMMAND`*, viết một tập tin kịch bản wrapper và đặt `GIT_SSH` trỏ đến nó hoặc sử dụng tập tin `~/.ssh/config`.

*`GIT_SSH_COMMAND`* đặt lệnh SSH được sử dụng khi Git cố gắng kết nối đến một máy chủ SSH.
Lệnh được thông dịch bởi shell, và các đối số dòng lệnh bổ sung có thể được sử dụng với `ssh`, chẳng hạn như `GIT_SSH_COMMAND="ssh -i ~/.ssh/my_key" git clone git@example.com:my/repo`.

*`GIT_ASKPASS`* là một ghi đè cho giá trị cấu hình `core.askpass`.
Đây là chương trình được gọi bất cứ khi nào Git cần yêu cầu người dùng nhập thông tin xác thực, có thể mong đợi một dấu nhắc văn bản như một đối số dòng lệnh, và nên trả về câu trả lời trên `stdout` (xem <<ch07-git-tools#_credential_caching>> để biết thêm về hệ thống con này).

*`GIT_NAMESPACE`* kiểm soát quyền truy cập vào các tham chiếu có namespace, và tương đương với cờ `--namespace`.
Điều này chủ yếu hữu ích ở phía máy chủ, nơi bạn có thể muốn lưu trữ nhiều fork của một kho chứa duy nhất trong một kho chứa, chỉ giữ các tham chiếu riêng biệt.

*`GIT_FLUSH`* có thể được sử dụng để buộc Git sử dụng I/O không được đệm khi ghi dần dần vào stdout.
Giá trị 1 khiến Git xả thường xuyên hơn, giá trị 0 khiến tất cả đầu ra được đệm.
Giá trị mặc định (nếu biến này không được đặt) là chọn một lược đồ đệm thích hợp tùy thuộc vào hoạt động và chế độ đầu ra.

*`GIT_REFLOG_ACTION`* cho phép bạn chỉ định văn bản mô tả được ghi vào reflog.
Đây là một ví dụ:

[source,console]
----
$ GIT_REFLOG_ACTION="my action" git commit --allow-empty -m 'My message'
[master 9e3d55a] My message
$ git reflog -1
9e3d55a HEAD@{0}: my action: My message
----
