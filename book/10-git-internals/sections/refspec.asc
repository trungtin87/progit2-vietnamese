[[_refspec]]
=== Refspec

Trong suốt cuốn sách này, chúng ta đã sử dụng các ánh xạ đơn giản từ các nhánh từ xa đến các tham chiếu cục bộ, nhưng chúng có thể phức tạp hơn.
Giả sử bạn đang theo dõi với một vài phần cuối cùng và đã tạo một kho chứa Git cục bộ nhỏ, và bây giờ muốn thêm một _remote_ vào nó:

[source,console]
----
$ git remote add origin https://github.com/schacon/simplegit-progit
----

Chạy lệnh trên sẽ thêm một phần vào tập tin `.git/config` của kho chứa, chỉ định tên của remote (`origin`), URL của kho chứa từ xa, và _refspec_ được sử dụng để lấy:

[source,ini]
----
[remote "origin"]
	url = https://github.com/schacon/simplegit-progit
	fetch = +refs/heads/*:refs/remotes/origin/*
----

Định dạng của refspec là, đầu tiên, một `+` tùy chọn, theo sau là `<src>:<dst>`, trong đó `<src>` là mẫu cho các tham chiếu ở phía từ xa và `<dst>` là nơi các tham chiếu đó sẽ được theo dõi cục bộ.
`+` bảo Git cập nhật tham chiếu ngay cả khi nó không phải là một fast-forward.

Trong trường hợp mặc định được tự động viết bởi lệnh `git remote add origin`, Git lấy tất cả các tham chiếu dưới `refs/heads/` trên máy chủ và ghi chúng vào `refs/remotes/origin/` cục bộ.
Vì vậy, nếu có một nhánh `master` trên máy chủ, bạn có thể truy cập nhật ký của nhánh đó cục bộ thông qua bất kỳ cái nào sau đây:

[source,console]
----
$ git log origin/master
$ git log remotes/origin/master
$ git log refs/remotes/origin/master
----

Tất cả đều tương đương, vì Git mở rộng mỗi cái trong số chúng thành `refs/remotes/origin/master`.

Nếu bạn muốn Git thay vào đó chỉ kéo xuống nhánh `master` mỗi lần, và không phải mọi nhánh khác trên máy chủ từ xa, bạn có thể thay đổi dòng fetch để chỉ tham chiếu đến nhánh đó:

[source]
----
fetch = +refs/heads/master:refs/remotes/origin/master
----

Đây chỉ là refspec mặc định cho `git fetch` cho remote đó.
Nếu bạn muốn thực hiện một lần lấy duy nhất, bạn cũng có thể chỉ định refspec cụ thể trên dòng lệnh.
Để kéo nhánh `master` trên remote xuống `origin/mymaster` cục bộ, bạn có thể chạy:

[source,console]
----
$ git fetch origin master:refs/remotes/origin/mymaster
----

Bạn cũng có thể chỉ định nhiều refspec.
Trên dòng lệnh, bạn có thể kéo xuống một số nhánh như thế này:

[source,console]
----
$ git fetch origin master:refs/remotes/origin/mymaster \
	 topic:refs/remotes/origin/topic
From git@github.com:schacon/simplegit
 ! [rejected]        master     -> origin/mymaster  (non fast forward)
 * [new branch]      topic      -> origin/topic
----

Trong trường hợp này, việc kéo nhánh `master` đã bị từ chối vì nó không được liệt kê là một tham chiếu fast-forward.
Bạn có thể ghi đè điều đó bằng cách chỉ định `+` ở phía trước refspec.

Bạn cũng có thể chỉ định nhiều refspec để lấy trong tập tin cấu hình của mình.
Nếu bạn muốn luôn lấy các nhánh `master` và `experiment` từ remote `origin`, hãy thêm hai dòng:

[source,ini]
----
[remote "origin"]
	url = https://github.com/schacon/simplegit-progit
	fetch = +refs/heads/master:refs/remotes/origin/master
	fetch = +refs/heads/experiment:refs/remotes/origin/experiment
----

Kể từ Git 2.6.0, bạn có thể sử dụng các glob một phần trong mẫu để khớp với nhiều nhánh, vì vậy điều này hoạt động:

[source,ini]
----
fetch = +refs/heads/qa*:refs/remotes/origin/qa*
----

Thậm chí tốt hơn, bạn có thể sử dụng namespace (hoặc thư mục) để hoàn thành điều tương tự với cấu trúc nhiều hơn.
Nếu bạn có một nhóm QA đẩy một loạt các nhánh, và bạn muốn lấy nhánh `master` và bất kỳ nhánh nào của nhóm QA nhưng không có gì khác, bạn có thể sử dụng một phần cấu hình như thế này:

[source,ini]
----
[remote "origin"]
	url = https://github.com/schacon/simplegit-progit
	fetch = +refs/heads/master:refs/remotes/origin/master
	fetch = +refs/heads/qa/*:refs/remotes/origin/qa/*
----

Nếu bạn có một quy trình làm việc phức tạp có một nhóm QA đẩy các nhánh, các nhà phát triển đẩy các nhánh, và các nhóm tích hợp đẩy và cộng tác trên các nhánh từ xa, bạn có thể đặt namespace cho chúng dễ dàng theo cách này.

[[_pushing_refspecs]]
==== Đẩy Refspec

Thật tốt khi bạn có thể lấy các tham chiếu có namespace theo cách đó, nhưng làm thế nào nhóm QA đưa các nhánh của họ vào namespace `qa/` ngay từ đầu?
Bạn hoàn thành điều đó bằng cách sử dụng refspec để đẩy.

Nếu nhóm QA muốn đẩy nhánh `master` của họ lên `qa/master` trên máy chủ từ xa, họ có thể chạy:

[source,console]
----
$ git push origin master:refs/heads/qa/master
----

Nếu họ muốn Git tự động làm điều đó mỗi khi họ chạy `git push origin`, họ có thể thêm một giá trị `push` vào tập tin cấu hình của họ:

[source,ini]
----
[remote "origin"]
	url = https://github.com/schacon/simplegit-progit
	fetch = +refs/heads/*:refs/remotes/origin/*
	push = refs/heads/master:refs/heads/qa/master
----

Một lần nữa, điều này sẽ khiến `git push origin` đẩy nhánh `master` cục bộ lên nhánh `qa/master` từ xa theo mặc định.

[NOTE]
====
Bạn không thể sử dụng refspec để lấy từ một kho chứa và đẩy đến một kho chứa khác.
Để biết ví dụ làm như vậy, hãy tham khảo <<ch06-github#_fetch_and_push_on_different_repositories>>.
====

==== Xóa Tham chiếu

Bạn cũng có thể sử dụng refspec để xóa các tham chiếu khỏi máy chủ từ xa bằng cách chạy một cái gì đó như thế này:

[source,console]
----
$ git push origin :topic
----

Vì refspec là `<src>:<dst>`, bằng cách bỏ phần `<src>`, điều này về cơ bản nói là làm cho nhánh `topic` trên remote không có gì, điều này xóa nó.

Hoặc bạn có thể sử dụng cú pháp mới hơn (có sẵn kể từ Git v1.7.0):

[source,console]
----
$ git push origin --delete topic
----
