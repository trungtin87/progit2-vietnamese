[[_interactive_staging]]
=== Tổ chức Tương tác

Trong phần này, bạn sẽ xem xét một vài lệnh Git tương tác có thể giúp bạn tạo các cam kết của mình để chỉ bao gồm các sự kết hợp và các phần nhất định của các tệp.
Các công cụ này hữu ích nếu bạn sửa đổi nhiều tệp một cách rộng rãi, sau đó quyết định rằng bạn muốn các thay đổi đó được phân vùng thành một vài cam kết tập trung thay vì một cam kết lớn lộn xộn.
Bằng cách này, bạn có thể đảm bảo các cam kết của bạn là các tập hợp thay đổi được tách biệt một cách hợp lý và có thể được xem xét dễ dàng bởi các nhà phát triển làm việc cùng bạn.

Nếu bạn chạy `git add` với tùy chọn `-i` hoặc `--interactive`, Git sẽ vào chế độ shell tương tác, hiển thị một cái gì đó như thế này:

[source,console]
----
$ git add -i
           staged     unstaged path
  1:    unchanged        +0/-1 TODO
  2:    unchanged        +1/-1 index.html
  3:    unchanged        +5/-1 lib/simplegit.rb

*** Commands ***
  1: [s]tatus     2: [u]pdate      3: [r]evert     4: [a]dd untracked
  5: [p]atch      6: [d]iff        7: [q]uit       8: [h]elp
What now>
----

Bạn có thể thấy rằng lệnh này cho bạn thấy một cái nhìn rất khác về khu vực tổ chức của bạn so với những gì bạn có lẽ đã quen thuộc -- về cơ bản, thông tin tương tự bạn nhận được với `git status` nhưng ngắn gọn và nhiều thông tin hơn một chút.
Nó liệt kê các thay đổi bạn đã tổ chức ở bên trái và các thay đổi chưa tổ chức ở bên phải.

Sau đó là phần "`Commands`", cho phép bạn thực hiện một số việc như tổ chức và hủy tổ chức tệp, tổ chức các phần của tệp, thêm các tệp chưa được theo dõi và hiển thị các diff của những gì đã được tổ chức.

==== Tổ chức và Hủy tổ chức Tệp

Nếu bạn gõ `u` hoặc `2` (cho cập nhật) tại dấu nhắc `What now>`, bạn sẽ được hỏi tệp nào bạn muốn tổ chức:

[source,console]
----
What now> u
           staged     unstaged path
  1:    unchanged        +0/-1 TODO
  2:    unchanged        +1/-1 index.html
  3:    unchanged        +5/-1 lib/simplegit.rb
Update>>
----

Để tổ chức các tệp `TODO` và `index.html`, bạn có thể gõ các số:

[source,console]
----
Update>> 1,2
           staged     unstaged path
* 1:    unchanged        +0/-1 TODO
* 2:    unchanged        +1/-1 index.html
  3:    unchanged        +5/-1 lib/simplegit.rb
Update>>
----

Dấu `*` bên cạnh mỗi tệp có nghĩa là tệp đã được chọn để tổ chức.
Nếu bạn nhấn Enter sau khi không gõ gì tại dấu nhắc `Update>>`, Git sẽ lấy bất kỳ thứ gì được chọn và tổ chức nó cho bạn:

[source,console]
----
Update>>
updated 2 paths

*** Commands ***
  1: [s]tatus     2: [u]pdate      3: [r]evert     4: [a]dd untracked
  5: [p]atch      6: [d]iff        7: [q]uit       8: [h]elp
What now> s
           staged     unstaged path
  1:        +0/-1      nothing TODO
  2:        +1/-1      nothing index.html
  3:    unchanged        +5/-1 lib/simplegit.rb
----

Bây giờ bạn có thể thấy rằng các tệp `TODO` và `index.html` đã được tổ chức và tệp `simplegit.rb` vẫn chưa được tổ chức.
Nếu bạn muốn hủy tổ chức tệp `TODO` tại thời điểm này, bạn sử dụng tùy chọn `r` hoặc `3` (cho hoàn nguyên):

[source,console]
----
*** Commands ***
  1: [s]tatus     2: [u]pdate      3: [r]evert     4: [a]dd untracked
  5: [p]atch      6: [d]iff        7: [q]uit       8: [h]elp
What now> r
           staged     unstaged path
  1:        +0/-1      nothing TODO
  2:        +1/-1      nothing index.html
  3:    unchanged        +5/-1 lib/simplegit.rb
Revert>> 1
           staged     unstaged path
* 1:        +0/-1      nothing TODO
  2:        +1/-1      nothing index.html
  3:    unchanged        +5/-1 lib/simplegit.rb
Revert>> [enter]
reverted one path
----

Nhìn vào trạng thái Git của bạn một lần nữa, bạn có thể thấy rằng bạn đã hủy tổ chức tệp `TODO`:

[source,console]
----
*** Commands ***
  1: [s]tatus     2: [u]pdate      3: [r]evert     4: [a]dd untracked
  5: [p]atch      6: [d]iff        7: [q]uit       8: [h]elp
What now> s
           staged     unstaged path
  1:    unchanged        +0/-1 TODO
  2:        +1/-1      nothing index.html
  3:    unchanged        +5/-1 lib/simplegit.rb
----

Để xem diff của những gì bạn đã tổ chức, bạn có thể sử dụng lệnh `d` hoặc `6` (cho diff).
Nó hiển thị cho bạn một danh sách các tệp đã tổ chức của bạn, và bạn có thể chọn những tệp mà bạn muốn xem diff đã tổ chức.
Điều này giống như chỉ định `git diff --cached` trên dòng lệnh:

[source,console]
----
*** Commands ***
  1: [s]tatus     2: [u]pdate      3: [r]evert     4: [a]dd untracked
  5: [p]atch      6: [d]iff        7: [q]uit       8: [h]elp
What now> d
           staged     unstaged path
  1:        +1/-1      nothing index.html
Review diff>> 1
diff --git a/index.html b/index.html
index 4d07108..4335f49 100644
--- a/index.html
+++ b/index.html
@@ -16,7 +16,7 @@ Date Finder

 <p id="out">...</p>

-<div id="footer">contact : support@github.com</div>
+<div id="footer">contact : email.support@github.com</div>

 <script type="text/javascript">
----

Với các lệnh cơ bản này, bạn có thể sử dụng chế độ thêm tương tác để xử lý khu vực tổ chức của mình dễ dàng hơn một chút.

==== Tổ chức các Bản vá

Cũng có thể để Git tổ chức các _phần_ nhất định của các tệp chứ không phải phần còn lại.
Ví dụ, nếu bạn thực hiện hai thay đổi cho tệp `simplegit.rb` của mình và muốn tổ chức một trong số chúng chứ không phải cái kia, việc làm điều đó rất dễ dàng trong Git.
Từ dấu nhắc tương tác tương tự được giải thích trong phần trước, gõ `p` hoặc `5` (cho bản vá).
Git sẽ hỏi bạn tệp nào bạn muốn tổ chức một phần; sau đó, đối với mỗi phần của các tệp đã chọn, nó sẽ hiển thị các đoạn diff của tệp và hỏi bạn có muốn tổ chức chúng hay không, từng cái một:

[source,console]
----
diff --git a/lib/simplegit.rb b/lib/simplegit.rb
index dd5ecc4..57399e0 100644
--- a/lib/simplegit.rb
+++ b/lib/simplegit.rb
@@ -22,7 +22,7 @@ class SimpleGit
   end

   def log(treeish = 'master')
-    command("git log -n 25 #{treeish}")
+    command("git log -n 30 #{treeish}")
   end

   def blame(path)
Stage this hunk [y,n,a,d,/,j,J,g,e,?]?
----

Bạn có rất nhiều lựa chọn tại thời điểm này.
Gõ `?` hiển thị danh sách những gì bạn có thể làm:

[source,console]
----
Stage this hunk [y,n,a,d,/,j,J,g,e,?]? ?
y - stage this hunk
n - do not stage this hunk
a - stage this and all the remaining hunks in the file
d - do not stage this hunk nor any of the remaining hunks in the file
g - select a hunk to go to
/ - search for a hunk matching the given regex
j - leave this hunk undecided, see next undecided hunk
J - leave this hunk undecided, see next hunk
k - leave this hunk undecided, see previous undecided hunk
K - leave this hunk undecided, see previous hunk
s - split the current hunk into smaller hunks
e - manually edit the current hunk
? - print help
----

Nói chung, bạn sẽ gõ `y` hoặc `n` nếu bạn muốn tổ chức từng đoạn, nhưng tổ chức tất cả chúng trong một số tệp nhất định hoặc bỏ qua quyết định đoạn cho đến sau này cũng có thể hữu ích.
Nếu bạn tổ chức một phần của tệp và để phần khác chưa được tổ chức, đầu ra trạng thái của bạn sẽ trông như thế này:

[source,console]
----
What now> 1
           staged     unstaged path
  1:    unchanged        +0/-1 TODO
  2:        +1/-1      nothing index.html
  3:        +1/-1        +4/-0 lib/simplegit.rb
----

Trạng thái của tệp `simplegit.rb` rất thú vị.
Nó cho bạn thấy rằng một vài dòng đã được tổ chức và một vài dòng chưa được tổ chức.
Bạn đã tổ chức một phần của tệp này.
Tại thời điểm này, bạn có thể thoát khỏi tập lệnh thêm tương tác và chạy `git commit` để cam kết các tệp đã được tổ chức một phần.

Bạn cũng không cần phải ở chế độ thêm tương tác để thực hiện việc tổ chức tệp một phần -- bạn có thể bắt đầu tập lệnh tương tự bằng cách sử dụng `git add -p` hoặc `git add --patch` trên dòng lệnh.

Hơn nữa, bạn có thể sử dụng chế độ bản vá để đặt lại một phần tệp bằng lệnh `git reset --patch`, để kiểm tra các phần của tệp bằng lệnh `git checkout --patch` và để cất giữ các phần của tệp bằng lệnh `git stash save --patch`.
Chúng ta sẽ đi sâu vào chi tiết hơn về từng cái này khi chúng ta sử dụng các lệnh này nâng cao hơn.