=== go-git

(((go-git)))(((Go)))
Trong trường hợp bạn muốn tích hợp Git vào một dịch vụ được viết bằng Golang, cũng có một triển khai thư viện Go thuần túy.
Triển khai này không có bất kỳ phụ thuộc gốc nào và do đó không dễ bị lỗi quản lý bộ nhớ thủ công.
Nó cũng minh bạch cho các công cụ phân tích hiệu suất Golang tiêu chuẩn như CPU, Memory profilers, race detector, v.v.

go-git tập trung vào khả năng mở rộng, tương thích và hỗ trợ hầu hết các API plumbing, được ghi lại tại https://github.com/go-git/go-git/blob/master/COMPATIBILITY.md[^].

Đây là một ví dụ cơ bản về việc sử dụng API Go:

[source, go]
----
import "github.com/go-git/go-git/v5"

r, err := git.PlainClone("/tmp/foo", false, &git.CloneOptions{
    URL:      "https://github.com/go-git/go-git",
    Progress: os.Stdout,
})
----

Ngay khi bạn có một instance `Repository`, bạn có thể truy cập thông tin và thực hiện các thay đổi trên nó:

[source, go]
----
// retrieves the branch pointed by HEAD
ref, err := r.Head()

// get the commit object, pointed by ref
commit, err := r.CommitObject(ref.Hash())

// retrieves the commit history
history, err := commit.History()

// iterates over the commits and print each
for _, c := range history {
    fmt.Println(c)
}
----

==== Chức năng Nâng cao

go-git có một vài tính năng nâng cao đáng chú ý, một trong số đó là hệ thống lưu trữ có thể cắm, tương tự như các backend Libgit2.
Triển khai mặc định là lưu trữ trong bộ nhớ, rất nhanh.

[source, go]
----
r, err := git.Clone(memory.NewStorage(), nil, &git.CloneOptions{
    URL: "https://github.com/go-git/go-git",
})
----

Lưu trữ có thể cắm cung cấp nhiều tùy chọn thú vị.
Ví dụ, https://github.com/go-git/go-git/tree/master/_examples/storage[^] cho phép bạn lưu trữ các tham chiếu, đối tượng, và cấu hình trong cơ sở dữ liệu Aerospike.

Một tính năng khác là trừu tượng hóa hệ thống tập tin linh hoạt.
Sử dụng https://pkg.go.dev/github.com/go-git/go-billy/v5?tab=doc#Filesystem[^] rất dễ dàng để lưu trữ tất cả các tập tin theo cách khác nhau, tức là bằng cách đóng gói tất cả chúng vào một kho lưu trữ duy nhất trên đĩa hoặc bằng cách giữ tất cả chúng trong bộ nhớ.

Một trường hợp sử dụng nâng cao khác bao gồm một máy khách HTTP có thể điều chỉnh tốt, chẳng hạn như cái được tìm thấy tại https://github.com/go-git/go-git/blob/master/_examples/custom_http/main.go[^].

[source, go]
----
customClient := &http.Client{
    Transport: &http.Transport{ // accept any certificate (might be useful for testing)
        TLSClientConfig: &tls.Config{InsecureSkipVerify: true},
    },
    Timeout: 15 * time.Second,  // 15 second timeout
        CheckRedirect: func(req *http.Request, via []*http.Request) error {
        return http.ErrUseLastResponse // don't follow redirect
    },
}

// Override http(s) default protocol to use our custom client
client.InstallProtocol("https", githttp.NewClient(customClient))

// Clone repository using the new client if the protocol is https://
r, err := git.Clone(memory.NewStorage(), nil, &git.CloneOptions{URL: url})
----

==== Đọc thêm

Một xử lý đầy đủ về khả năng của go-git nằm ngoài phạm vi của cuốn sách này.
Nếu bạn muốn thêm thông tin về go-git, có tài liệu API tại https://pkg.go.dev/github.com/go-git/go-git/v5[^], và một bộ ví dụ sử dụng tại https://github.com/go-git/go-git/tree/master/_examples[^].
