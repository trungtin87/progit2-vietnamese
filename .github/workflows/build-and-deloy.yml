name: Build and Deploy Pro Git Book
on:
  push:
    branches:
      - main # Chạy action mỗi khi có code mới được đẩy lên nhánh 'main'
  workflow_dispatch: # Cho phép bạn chạy action thủ công từ trang Actions

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # 1. Checkout code
      - name: Checkout Source Code
        uses: actions/checkout@v4
        
      # 2. Setup Ruby (Yêu cầu để cài Asciidoctor)
      - name: Setup Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.x' # Sử dụng phiên bản Ruby ổn định
          bundler-cache: true 

      # 3. Cài đặt Asciidoctor và các Gem liên quan
      - name: Install Asciidoctor and Dependencies
        run: |
          gem install asciidoctor
          # Nếu dự án có Gemfile, bạn nên chạy: bundle install
          
      # 4. Build AsciiDoc thành HTML
      - name: Build HTML Output
        run: |
          # Giả định file đầu vào là 'progit-vi.asc' và đầu ra là thư mục 'site'
          # Tùy thuộc vào cấu trúc dự án Pro Git 2 của bạn, lệnh này có thể khác
          asciidoctor -r asciidoctor-pdf -o index.html index.adoc
          # Hoặc nếu dự án dùng cấu trúc nhiều file:
          # Thường cần một script Ruby/Bash để build toàn bộ cuốn sách
          # Ví dụ: sh build.sh
          # Bạn cần kiểm tra lại lệnh build chính xác trong repository gốc của Pro Git 2.
          
      # 5. Thiết lập quyền ghi để Deploy
      - name: Setup Pages
        uses: actions/configure-pages@v5

      # 6. Upload các file đã build
      - name: Upload Artifacts
        uses: actions/upload-pages-artifact@v3
        with:
          path: './' # Thay bằng thư mục chứa HTML đã build, ví dụ: './_site'
          
      # 7. Deploy lên GitHub Pages
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
