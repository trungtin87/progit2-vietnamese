name: Build and Deploy AsciiDoc to Pages

# 1. Kích hoạt Action khi có push lên nhánh main, hoặc chạy thủ công
on:
  push:
    branches:
      - main
  workflow_dispatch:

# Cần thiết lập quyền để Action có thể triển khai lên GitHub Pages
permissions:
  contents: read
  pages: write 
  id-token: write 

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # 2. Checkout code nguồn
      - name: Checkout Source Code
        uses: actions/checkout@v4
        
      # 3. Setup Ruby (Yêu cầu để cài Asciidoctor)
      - name: Setup Ruby Environment
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.1' 
          bundler-cache: true 

      # 4. Cài đặt Asciidoctor (Qua RubyGems)
      - name: Install Asciidoctor
        run: gem install asciidoctor asciidoctor-pdf # Cài thêm asciidoctor-pdf nếu cần

      # 5. Build AsciiDoc thành HTML
      - name: Build AsciiDoc to HTML
        run: |
          mkdir _site
          # -----------------------------------------------------------------
          # CHÚ Ý QUAN TRỌNG: SỬA LẠI LỆNH NÀY CHO PHÙ HỢP VỚI DỰ ÁN CỦA BẠN
          # -----------------------------------------------------------------
          # Lệnh giả định (thay 'index.asc' bằng tên file AsciiDoc chính của bạn)
          asciidoctor index.asc -o _site/index.html
          
          # Nếu cần, copy các tài nguyên tĩnh (CSS, JS, ảnh) vào thư mục _site
          # cp -r assets _site/
          
      # 6. Thiết lập môi trường GitHub Pages
      - name: Setup Pages
        uses: actions/configure-pages@v5

      # 7. Upload Artifact (Sản phẩm HTML đã Build)
      # Chỉ định chính xác thư mục đã build (_site)
      - name: Upload Deployment Artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './_site' 
          
      # 8. Deploy lên GitHub Pages
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
